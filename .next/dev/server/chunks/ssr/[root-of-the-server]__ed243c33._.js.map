{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///home/tee/projects/personal/farcaster/roasted/src/components/Button.tsx"],"sourcesContent":["import React from 'react';\n\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  variant?: 'primary' | 'secondary' | 'outline';\n  isLoading?: boolean;\n}\n\nexport const Button: React.FC<ButtonProps> = ({ \n  children, \n  variant = 'primary', \n  isLoading = false, \n  className = '', \n  disabled,\n  ...props \n}) => {\n  const baseStyles = \"px-6 py-3 rounded-lg font-semibold transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer\";\n  \n  const variants = {\n    primary: \"bg-brand-500 hover:bg-brand-600 text-white shadow-lg shadow-brand-500/20\",\n    secondary: \"bg-white text-brand-900 hover:bg-gray-100 shadow-lg\",\n    outline: \"border-2 border-brand-500 text-brand-400 hover:bg-brand-900/30\"\n  };\n\n  return (\n    <button \n      className={`${baseStyles} ${variants[variant]} ${className}`}\n      disabled={disabled || isLoading}\n      {...props}\n    >\n      {isLoading ? (\n        <>\n          <svg className=\"animate-spin h-5 w-5 text-current\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n            <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n            <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n          </svg>\n        </>\n      ) : children}\n    </button>\n  );\n};"],"names":[],"mappings":";;;;;;AAOO,MAAM,SAAgC,CAAC,EAC5C,QAAQ,EACR,UAAU,SAAS,EACnB,YAAY,KAAK,EACjB,YAAY,EAAE,EACd,QAAQ,EACR,GAAG,OACJ;IACC,MAAM,aAAa;IAEnB,MAAM,WAAW;QACf,SAAS;QACT,WAAW;QACX,SAAS;IACX;IAEA,qBACE,+YAAC;QACC,WAAW,GAAG,WAAW,CAAC,EAAE,QAAQ,CAAC,QAAQ,CAAC,CAAC,EAAE,WAAW;QAC5D,UAAU,YAAY;QACrB,GAAG,KAAK;kBAER,0BACC;sBACE,cAAA,+YAAC;gBAAI,WAAU;gBAAoC,OAAM;gBAA6B,MAAK;gBAAO,SAAQ;;kCACxG,+YAAC;wBAAO,WAAU;wBAAa,IAAG;wBAAK,IAAG;wBAAK,GAAE;wBAAK,QAAO;wBAAe,aAAY;;;;;;kCACxF,+YAAC;wBAAK,WAAU;wBAAa,MAAK;wBAAe,GAAE;;;;;;;;;;;;4BAGrD;;;;;;AAGV"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///home/tee/projects/personal/farcaster/roasted/src/components/Input.tsx"],"sourcesContent":["import React from 'react';\n\ninterface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  label?: string;\n  error?: string;\n}\n\nexport const Input: React.FC<InputProps> = ({ label, error, className = '', ...props }) => {\n  return (\n    <div className=\"w-full\">\n      {label && <label className=\"block text-sm font-medium text-gray-300 mb-1.5\">{label}</label>}\n      <input\n        className={`w-full px-4 py-3 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent transition-all ${className}`}\n        {...props}\n      />\n      {error && <p className=\"mt-1 text-sm text-red-400\">{error}</p>}\n    </div>\n  );\n};"],"names":[],"mappings":";;;;;;AAOO,MAAM,QAA8B,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,YAAY,EAAE,EAAE,GAAG,OAAO;IACpF,qBACE,+YAAC;QAAI,WAAU;;YACZ,uBAAS,+YAAC;gBAAM,WAAU;0BAAkD;;;;;;0BAC7E,+YAAC;gBACC,WAAW,CAAC,4LAA4L,EAAE,WAAW;gBACpN,GAAG,KAAK;;;;;;YAEV,uBAAS,+YAAC;gBAAE,WAAU;0BAA6B;;;;;;;;;;;;AAG1D"}},
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":["file:///home/tee/projects/personal/farcaster/roasted/src/components/UserSearch.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Button } from './Button';\nimport { Input } from './Input';\n\ninterface UserSearchProps {\n  onSearch: (username: string) => void;\n  isLoading: boolean;\n  initialUsername?: string; // ‚úÖ New Prop\n}\n\nexport const UserSearch: React.FC<UserSearchProps> = ({ onSearch, isLoading, initialUsername }) => {\n  const [username, setUsername] = useState(initialUsername || '');\n\n  // ‚úÖ Auto-fill if initialUsername arrives late (async SDK load)\n  useEffect(() => {\n    if (initialUsername) {\n      setUsername(initialUsername);\n    }\n  }, [initialUsername]);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (username) {\n      onSearch(username);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"w-full max-w-md space-y-6 animate-fade-in relative z-20\">\n      <div className=\"text-center space-y-2\">\n        <h2 className=\"text-2xl font-bold text-white\">Who are you, really?</h2>\n        <p className=\"text-gray-400\">\n          Enter your Farcaster handle to get{' '}\n          <span className=\"font-chewy text-[1.2em]\">\n            Roasted\n          </span>.\n        </p>\n      </div>\n\n      <div className=\"space-y-4 bg-gray-800/50 p-6 rounded-xl border border-gray-700 backdrop-blur-sm relative\">\n        <Input \n          label=\"Farcaster Username\" \n          placeholder=\"dwr\" \n          value={username}\n          onChange={(e) => setUsername(e.target.value)}\n          required\n          autoComplete=\"off\"\n        />\n        \n        <Button type=\"submit\" className=\"w-full\" isLoading={isLoading}>\n         Roast Me\n        </Button>\n      </div>\n    </form>\n  );\n};"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAQO,MAAM,aAAwC,CAAC,EAAE,QAAQ,EAAE,SAAS,EAAE,eAAe,EAAE;IAC5F,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,kXAAQ,EAAC,mBAAmB;IAE5D,+DAA+D;IAC/D,IAAA,mXAAS,EAAC;QACR,IAAI,iBAAiB;YACnB,YAAY;QACd;IACF,GAAG;QAAC;KAAgB;IAEpB,MAAM,eAAe,CAAC;QACpB,EAAE,cAAc;QAChB,IAAI,UAAU;YACZ,SAAS;QACX;IACF;IAEA,qBACE,+YAAC;QAAK,UAAU;QAAc,WAAU;;0BACtC,+YAAC;gBAAI,WAAU;;kCACb,+YAAC;wBAAG,WAAU;kCAAgC;;;;;;kCAC9C,+YAAC;wBAAE,WAAU;;4BAAgB;4BACQ;0CACnC,+YAAC;gCAAK,WAAU;0CAA0B;;;;;;4BAEnC;;;;;;;;;;;;;0BAIX,+YAAC;gBAAI,WAAU;;kCACb,+YAAC,oIAAK;wBACJ,OAAM;wBACN,aAAY;wBACZ,OAAO;wBACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;wBAC3C,QAAQ;wBACR,cAAa;;;;;;kCAGf,+YAAC,sIAAM;wBAAC,MAAK;wBAAS,WAAU;wBAAS,WAAW;kCAAW;;;;;;;;;;;;;;;;;;AAMvE"}},
    {"offset": {"line": 291, "column": 0}, "map": {"version":3,"sources":["file:///home/tee/projects/personal/farcaster/roasted/src/app/actions.tsx"],"sourcesContent":["'use server';\n\nimport { GoogleGenAI } from \"@google/genai\";\nimport { put } from \"@vercel/blob\";\nimport Replicate from \"replicate\";\n\n// --- Types ---\nexport interface FarcasterUser {\n  fid: number;\n  username: string;\n  display_name: string;\n  pfp_url: string;\n  profile: { bio: { text: string } };\n  follower_count: number;\n  following_count: number;\n}\n\nexport interface Cast {\n  hash: string;\n  text: string;\n  parent_hash: string | null;\n  timestamp: string;\n  reactions: { likes_count: number; recasts_count: number };\n}\n\n// --- Configuration ---\n// Note: In Server Actions, process.env vars (without NEXT_PUBLIC) are secure.\nconst GEMINI_API_KEY = process.env.GEMINI_API_KEY || \"\";\nconst NEYNAR_API_KEY = process.env.NEYNAR_API_KEY || \"\";\nconst NEYNAR_API_URL = process.env.NEYNAR_API_URL || \"https://api.neynar.com/v2/farcaster\";\n\n// --- ACTION 1: Fetch User Data (Neynar) ---\nexport async function fetchUserDataAction(username: string): Promise<{\n  success: boolean;\n  user?: FarcasterUser;\n  castTexts?: string;\n  replyTexts?: string;\n  error?: string;\n}> {\n  try {\n    if (!NEYNAR_API_KEY) throw new Error(\"Missing NEYNAR_API_KEY in .env.local\");\n\n    const cleanUsername = username.replace(/^@/, '').trim().toLowerCase();\n\n    // 1. Fetch User\n    const userRes = await fetch(\n      `${NEYNAR_API_URL}/user/by_username?username=${cleanUsername}&viewer_fid=3`,\n      { headers: { 'accept': 'application/json', 'api_key': NEYNAR_API_KEY }, cache: 'no-store' }\n    );\n\n    if (!userRes.ok) {\n      if (userRes.status === 404) throw new Error(`User @${cleanUsername} not found.`);\n      if (userRes.status === 429) throw new Error(\"Neynar Rate limit hit. Wait a minute.\");\n      throw new Error(\"Failed to fetch user profile.\");\n    }\n    \n    const userData = await userRes.json();\n    const user = userData.user as FarcasterUser;\n\n    // 2. Fetch Casts (Limit 30, include replies)\n    const castsRes = await fetch(\n      `${NEYNAR_API_URL}/feed/user/casts?fid=${user.fid}&limit=30&include_replies=true&include_recasts=false`,\n      { headers: { 'accept': 'application/json', 'api_key': NEYNAR_API_KEY }, cache: 'no-store' }\n    );\n\n    let castTexts = \"\";\n    let replyTexts = \"\";\n\n    if (castsRes.ok) {\n      const castsData = await castsRes.json();\n      const allCasts = (castsData.casts || []) as Cast[];\n      \n      const primaryCasts = allCasts.filter(c => !c.parent_hash);\n      const replies = allCasts.filter(c => c.parent_hash);\n\n      castTexts = primaryCasts.slice(0, 15).map(c => `- ${c.text} (Likes: ${c.reactions.likes_count})`).join('\\n');\n      replyTexts = replies.slice(0, 15).map(c => `- ${c.text}`).join('\\n');\n    }\n\n    return { success: true, user, castTexts, replyTexts };\n\n  } catch (error: any) {\n    console.error('Fetch User Error:', error);\n    return { success: false, error: error.message || 'Server error' };\n  }\n}\n\n// --- ACTION 2: Generate Roast (Gemini) ---\nexport async function generateRoastAction(\n  user: FarcasterUser, \n  castTexts: string, \n  replyTexts: string\n): Promise<{ success: boolean; roast?: string; error?: string }> {\n  try {\n    if (!GEMINI_API_KEY) throw new Error(\"Missing GEMINI_API_KEY in .env.local\");\n    const ai = new GoogleGenAI({ apiKey: GEMINI_API_KEY });\n\n    const ratio = user.follower_count > 0 \n      ? (user.following_count / user.follower_count * 100).toFixed(0) \n      : \"0\";\n\n    const prompt = `\n      ROAST TARGET: Farcaster User @${user.username} (${user.display_name})\n      Bio: \"${user.profile.bio.text}\"\n      Followers: ${user.follower_count} | Following: ${user.following_count} (${ratio}% ratio üíÄ)\n\n      RECENT 90-DAY ACTIVITY (casts + ALL replies - dig for self-owns):\n      ${castTexts}\n      ${replyTexts ? `\\nTHEIR REPLIES (Expose these):\\n${replyTexts}` : '\\nNO REPLIES (ghost account vibes)'}\n\n      CRINGE AUDIT - EXPOSE THESE FIRST:\n      1. **Bio Cringe**: Tryhard keywords, emoji spam, humblebrags, \"DM for collabs\"\n      2. **Follower Ratio**: <10% = desperate followback farmer. >200% = spammer\n      3. **Content Patterns**: \n         - \"gm/fren/wagmi\" count >3 = braindead crypto zombie\n         - Replybegging (\"LFG @vitalik üëÄ\", ratio replies > casts)\n         - Self-quotes, \"just minted\" spam, \"who's building?\" virtue signals\n         - Copy-paste thought-leader diarrhea\n      4. **Engagement Whoring**: Likes-begging, \"drop below\", dead threads\n\n      TASK: Deliver STAND-UP COMEDIAN HECKLER ROAST (60 words max)\n      - Savage. Personal. Hit their deepest insecurity.\n      - Structure: Opening punch ‚Üí Cringe expose ‚Üí Brutal closer\n      - Voice: Don Rickles meets @basedjester\n      - NO hashtags, disclaimers, mercy.\n    `;\n\n    const roastRes = await ai.models.generateContent({\n      model: 'gemini-2.5-flash',\n      contents: prompt,\n      config: {\n        systemInstruction: \"You are a savage, ruthless roast master. You speak in a flowing, witty, and devastating manner. You do not list points, you weave them into a single brutal paragraph.\",\n        temperature: 1.1,\n      }\n    });\n\n    const roast = roastRes.text || \"You're too boring to roast.\";\n    return { success: true, roast };\n\n  } catch (error: any) {\n    console.error('Roast Gen Error:', error);\n    return { success: false, error: error.message || 'Server error' };\n  }\n}\n\n\n\n// --- ACTION 3: Generate Meme (Using Replicate) ---\nexport async function generateMemeAction(user: FarcasterUser, roast: string): Promise<{\n  success: boolean;\n  memeUrl?: string;\n  error?: string;\n}> {\n  try {\n    if (!process.env.REPLICATE_API_TOKEN) {\n      throw new Error(\"Missing REPLICATE_API_TOKEN\");\n    }\n\n    const replicate = new Replicate({\n      auth: process.env.REPLICATE_API_TOKEN,\n    });\n\n    console.log(\"Distorting PFP using Instruct-Pix2Pix:\", user.username);\n\n    // Prompt: Instructions for how to change the face\n    const prompt = `\n      Turn this person into a crying clown. \n      Apply a deep fried meme filter. \n      Make the face look devastated, melting, and roasted.\n      Context: ${roast.slice(0, 30)}\n    `;\n\n    // MODEL: Instruct-Pix2Pix\n    // This is the ONLY fast model that reliably edits faces instead of replacing them.\n    const output = await replicate.run(\n      \"timothybrooks/instruct-pix2pix:30c1d0b916a6f8efce20493f5d61ee27491ab2a60437c13c588468b9810ec23f\",\n      {\n        input: {\n          image: user.pfp_url,    // ‚úÖ The PFP goes here\n          prompt: prompt,         // ‚úÖ The command goes here\n          image_guidance_scale: 1.5, // 1.5 = Keep face shape, but change texture\n          num_inference_steps: 20,\n        }\n      }\n    );\n\n    const memeUrl = Array.isArray(output) ? String(output[0]) : String(output);\n\n    return { success: true, memeUrl };\n\n  } catch (error: any) {\n    console.error(\"Replicate Error:\", error);\n    return { success: true, memeUrl: user.pfp_url }; // Fallback to original PFP\n  }\n}\n\n// --- ACTION 4: Upload Image to Vercel Blob ---\nexport async function uploadImageAction(formData: FormData): Promise<string> {\n  const file = formData.get('file') as File;\n  const filename = formData.get('filename') as string;\n\n  if (!file) {\n    throw new Error('No file provided');\n  }\n\n  // Upload to Vercel Blob\n  const blob = await put(filename, file, {\n    access: 'public',\n  });\n\n  return blob.url; // Returns the https://... public URL\n}"],"names":[],"mappings":";;;;;;;IAqMsB,oBAAA,WAAA,GAAA,IAAA,gZAAA,EAAA,8CAAA,qYAAA,EAAA,KAAA,GAAA,2YAAA,EAAA"}},
    {"offset": {"line": 393, "column": 0}, "map": {"version":3,"sources":["file:///home/tee/projects/personal/farcaster/roasted/src/components/RoastCard.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport { FarcasterUser } from '../types';\nimport { Button } from './Button';\nimport { uploadImageAction } from '../app/actions'; \nimport { sdk } from \"@farcaster/miniapp-sdk\";\n\ninterface RoastCardProps {\n  user: FarcasterUser;\n  roast: string;\n  memeUrl: string | null;\n  isMemeLoading?: boolean;\n  viewerUsername?: string; \n  onReset: () => void;\n  onStopMusic?: () => void; // ‚úÖ New Prop\n}\n\n// Reusing success sound for now\nconst SFX = {\n  WHOOSH: '/sounds/success.wav',\n  BOING: '/sounds/success.wav'\n};\n\nconst LOGO_DATA_URI = \"/roasted-logo.png\";\nconst PRODUCTION_FRAME_URL = \"https://castroast.vercel.app\";\n\nexport const RoastCard: React.FC<RoastCardProps> = ({ \n  user, \n  roast, \n  memeUrl, \n  isMemeLoading, \n  viewerUsername, \n  onReset, \n  onStopMusic // Destructure prop\n}) => {\n  const [isSharing, setIsSharing] = useState(false);\n  const [statusMessage, setStatusMessage] = useState<string | null>(null);\n\n  const playSound = (url: string, volume = 1.0, delay = 0) => {\n    setTimeout(() => {\n      try {\n        const audio = new Audio(url);\n        audio.volume = volume;\n        audio.play().catch(() => {});\n      } catch (e) { console.error(e); }\n    }, delay);\n  };\n\n  useEffect(() => {\n    playSound(SFX.WHOOSH, 0.8);\n  }, []);\n\n  // --- CANVAS GENERATION (Kept your exact logic) ---\n  const generateCompositeImage = async (): Promise<Blob | null> => {\n    return new Promise((resolve) => {\n      const canvas = document.createElement('canvas');\n      const ctx = canvas.getContext('2d');\n      if (!ctx) { resolve(null); return; }\n      const ctx2: CanvasRenderingContext2D = ctx;\n      const styles = getComputedStyle(document.body);\n      const chewyFont = styles.getPropertyValue('--font-chewy') || 'cursive'; \n      const robotoFont = styles.getPropertyValue('--font-roboto') || 'Roboto, sans-serif';\n      const width = 1080;\n      const height = 1080;\n      canvas.width = width;\n      canvas.height = height;\n\n      // 1. Background (Your Gradient)\n      const gradient = ctx2.createLinearGradient(0, 0, 0, height);\n      gradient.addColorStop(0, '#471382'); \n      gradient.addColorStop(1, '#1a0530');\n      ctx2.fillStyle = gradient;\n      ctx2.fillRect(0, 0, width, height);\n\n      // 2. Header\n      ctx2.fillStyle = '#f15a24';\n      ctx2.fillRect(0, 0, width, 100);\n      ctx2.fillStyle = '#ffffff';\n      ctx2.font = `50px ${chewyFont}`;\n      ctx2.textAlign = 'center';\n      ctx2.textBaseline = 'middle';\n      ctx2.fillText('‚ö†Ô∏è EMOTIONAL DAMAGE DETECTED ‚ö†Ô∏è', width / 2, 50);\n\n      // 3. Draw Content\n      const drawContent = (memeImg?: HTMLImageElement) => {\n        const footerY = height - 50; \n        const footerRightMargin = 50; \n        \n        ctx2.font = 'bold 24px Inter, sans-serif';\n        ctx2.fillStyle = 'rgba(255, 255, 255, 0.6)';\n        ctx2.textAlign = 'right';\n        ctx2.textBaseline = 'middle';\n        \n        const footerText = \"Roasted Analysis\";\n        const textMetrics = ctx2.measureText(footerText);\n        const textX = width - footerRightMargin;\n        ctx2.fillText(footerText, textX, footerY);\n\n        const logoSize = 40;\n        const logoPadding = 15;\n        const logoX = textX - textMetrics.width - logoPadding - logoSize;\n        const logoY = footerY - (logoSize / 2); \n\n        const logoImg = new Image();\n        logoImg.onload = () => {\n          ctx2.drawImage(logoImg, logoX, logoY, logoSize, logoSize);\n          finalize();\n        };\n        logoImg.onerror = finalize; \n        logoImg.src = LOGO_DATA_URI;\n        \n        function finalize() {\n          ctx2.fillStyle = '#ffffff';\n          ctx2.font = 'bold 32px Inter, sans-serif';\n          ctx2.textAlign = 'left';\n          ctx2.textBaseline = 'alphabetic'; \n          ctx2.fillText(`@${user.username}`, 50, height - 40);\n          \n          ctx2.fillStyle = '#ffffff';\n          ctx2.font = `36px ${robotoFont}`; \n          ctx2.textAlign = 'center';\n          const imgSize = 320;\n          const textX = width / 2;\n          const textY = memeImg ? (150 + imgSize + 60) : 300; \n          const maxWidth = 950;\n          const lineHeight = 70; \n          const words = roast.split(' ');\n          let line = '';\n          let y = textY;\n          for (let n = 0; n < words.length; n++) {\n            const testLine = line + words[n] + ' ';\n            const metrics = ctx2.measureText(testLine);\n            const testWidth = metrics.width;\n            if (testWidth > maxWidth && n > 0) {\n              ctx2.fillText(line, textX, y);\n              line = words[n] + ' ';\n              y += lineHeight;\n            } else {\n              line = testLine;\n            }\n          }\n          ctx2.fillText(line, textX, y);\n          canvas.toBlob((blob) => {\n            resolve(blob);\n          }, 'image/png');\n        }\n      };\n\n      if (memeUrl) {\n        const img = new Image();\n        img.crossOrigin = 'anonymous';\n        img.onload = () => {\n          const imgSize = 320;\n          const cx = width / 2;\n          const cy = 150 + (imgSize / 2);\n          ctx2.save();\n          ctx2.translate(cx, cy);\n          ctx2.rotate(-5 * Math.PI / 180);\n          ctx2.shadowColor = '#f15a24';\n          ctx2.shadowBlur = 40;\n          ctx2.drawImage(img, -imgSize/2, -imgSize/2, imgSize, imgSize);\n          ctx2.shadowBlur = 0; \n          ctx2.strokeStyle = '#374151';\n          ctx2.lineWidth = 4;\n          ctx2.strokeRect(-imgSize/2, -imgSize/2, imgSize, imgSize);\n          ctx2.restore(); \n          drawContent(img);\n        };\n        img.onerror = () => { drawContent(); };\n        img.src = memeUrl;\n      } else {\n        drawContent();\n      }\n    });\n  };\n\n  const handleShare = async () => {\n    // ‚úÖ Stop music when share is clicked\n    if (onStopMusic) onStopMusic();\n\n    setIsSharing(true);\n    setStatusMessage(\"Generating Image...\");\n\n    try {\n      const imageBlob = await generateCompositeImage();\n      if (!imageBlob) throw new Error(\"Failed to generate image\");\n\n      setStatusMessage(\"Uploading...\");\n      const filename = `roast-${user.username}-${Date.now()}.png`;\n      const formData = new FormData();\n      formData.append('file', imageBlob, filename);\n      formData.append('filename', filename);\n\n      const publicImageUrl = await uploadImageAction(formData);\n\n      let caption = \"\";\n      const CREATOR_HANDLE = \"@teesmilex.base.eth\";\n      if (viewerUsername && viewerUsername.toLowerCase() !== user.username.toLowerCase()) {\n         caption = `@${viewerUsername} just roasted @${user.username} with castroast üòÇüíÄ\\n\\nCheck yours or roast a fren:`;\n      } else {\n         caption = `@${user.username} just got roasted by castroast üòÇ\\n\\nCheck yours:`;\n      }\n      caption += ` - Roasted by ${CREATOR_HANDLE}`\n      \n      try {\n        await sdk.actions.composeCast({\n          text: caption,\n          embeds: [publicImageUrl, PRODUCTION_FRAME_URL] \n        });\n        setStatusMessage(\"Composer Opened!\");\n      } catch (sdkError) {\n        console.warn(\"SDK not active. Downloading...\", sdkError);\n        const url = URL.createObjectURL(imageBlob);\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = `roasted-${user.username}.png`;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        URL.revokeObjectURL(url);\n        setStatusMessage(\"Image Downloaded!\");\n      }\n\n      setIsSharing(false);\n      setTimeout(() => setStatusMessage(null), 3000);\n\n    } catch (error) {\n      console.error(\"Share failed\", error);\n      setIsSharing(false);\n      setStatusMessage(\"Error sharing image\");\n    }\n  };\n\n  const handleRoastAnother = () => {\n    playSound(SFX.BOING, 1.0);\n    setTimeout(() => onReset(), 150);\n  };\n\n  const LogoIcon = () => (\n    <img src={LOGO_DATA_URI} alt=\"Roasted Logo\" className=\"w-10 h-10 object-contain rounded-lg shadow-sm\" />\n  );\n\n  return (\n    <div className=\"w-full max-w-2xl animate-slide-up pb-12\">\n      <div className=\"bg-[#471382] rounded-2xl overflow-hidden shadow-2xl border border-gray-800 relative flex flex-col\">\n        \n        {/* Header */}\n        <div className=\"bg-brand-500 p-2 text-center shadow-lg z-10\">\n             <h3 className=\"text-white text-lg sm:text-xl uppercase tracking-widest m-0 animate-pulse font-chewy\">\n               ‚ö†Ô∏è Emotional Damage Detected ‚ö†Ô∏è\n             </h3>\n        </div>\n\n        {/* Content Body */}\n        <div className=\"p-6 sm:p-8 flex flex-col md:flex-row items-center gap-6 bg-[#280b51]\">\n          <div className=\"flex-1 order-2 md:order-1 w-full\">\n            <div \n              className=\"text-lg sm:text-2xl leading-loose text-center md:text-left text-white drop-shadow-md prose prose-invert max-w-none font-normal\"\n              style={{ fontFamily: 'var(--font-roboto)' }}\n            >\n               <ReactMarkdown>{roast}</ReactMarkdown>\n            </div>\n          </div>\n\n          <div className=\"flex-shrink-0 order-1 md:order-2 flex flex-col items-center gap-2\">\n            {isMemeLoading ? (\n              <div className=\"w-32 h-32 sm:w-40 sm:h-40 rounded-xl bg-gray-800 border-2 border-gray-700 animate-pulse flex items-center justify-center\">\n                 <svg className=\"animate-spin h-8 w-8 text-brand-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n                    <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n                    <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n                  </svg>\n              </div>\n            ) : memeUrl ? (\n              <div className=\"relative group\">\n                <div className=\"absolute -inset-1 bg-gradient-to-r from-brand-500 to-red-600 rounded-xl blur opacity-75 group-hover:opacity-100 transition duration-200\"></div>\n                <img \n                  src={memeUrl} \n                  alt=\"Distorted Profile\" \n                  className=\"relative w-32 h-32 sm:w-40 sm:h-40 rounded-xl object-cover border-2 border-gray-800 shadow-2xl rotate-2 hover:rotate-0 transition-transform duration-300\"\n                />\n              </div>\n            ) : null}\n          </div>\n        </div>\n\n        {/* User Info Footer */}\n        <div className=\"bg-[#13111a] p-4 flex items-center justify-between border-t border-gray-800 backdrop-blur-sm\">\n          <div className=\"flex items-center gap-3\">\n             <img src={user.pfp_url} alt={user.username} className=\"w-10 h-10 rounded-full border border-gray-600 grayscale hover:grayscale-0 transition-all\" />\n            <div className=\"text-sm\">\n              <p className=\"text-gray-200 font-bold\">@{user.username}</p>\n              <p className=\"text-gray-500 text-xs\">FID: {user.fid}</p>\n            </div>\n          </div>\n          <div className=\"flex items-center justify-center gap-4\">\n            <LogoIcon />\n            <div className=\"text-gray-500 text-xs flex flex-col items-center\">\n               <p>Roasted Analysis</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Buttons */}\n        <div className=\"bg-[#0f0e17] p-4 flex flex-col sm:flex-row gap-3 justify-center sm:justify-end border-t border-gray-900\">\n          {statusMessage && (\n             <div className=\"text-brand-400 text-sm font-bold self-center animate-pulse text-center\">\n               {statusMessage}\n             </div>\n          )}\n          <Button variant=\"outline\" onClick={handleRoastAnother} className=\"text-sm px-4 py-2\">\n            Roast Another\n          </Button>\n          <Button onClick={handleShare} isLoading={isSharing} className=\"text-sm px-4 py-2 bg-brand-400 hover:bg-brand-500\">\n            Share\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;AACA;AACA;AAAA;AAPA;;;;;;;AAmBA,gCAAgC;AAChC,MAAM,MAAM;IACV,QAAQ;IACR,OAAO;AACT;AAEA,MAAM,gBAAgB;AACtB,MAAM,uBAAuB;AAEtB,MAAM,YAAsC,CAAC,EAClD,IAAI,EACJ,KAAK,EACL,OAAO,EACP,aAAa,EACb,cAAc,EACd,OAAO,EACP,WAAW,AAAC,mBAAmB;EAChC;IACC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,kXAAQ,EAAC;IAC3C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,kXAAQ,EAAgB;IAElE,MAAM,YAAY,CAAC,KAAa,SAAS,GAAG,EAAE,QAAQ,CAAC;QACrD,WAAW;YACT,IAAI;gBACF,MAAM,QAAQ,IAAI,MAAM;gBACxB,MAAM,MAAM,GAAG;gBACf,MAAM,IAAI,GAAG,KAAK,CAAC,KAAO;YAC5B,EAAE,OAAO,GAAG;gBAAE,QAAQ,KAAK,CAAC;YAAI;QAClC,GAAG;IACL;IAEA,IAAA,mXAAS,EAAC;QACR,UAAU,IAAI,MAAM,EAAE;IACxB,GAAG,EAAE;IAEL,oDAAoD;IACpD,MAAM,yBAAyB;QAC7B,OAAO,IAAI,QAAQ,CAAC;YAClB,MAAM,SAAS,SAAS,aAAa,CAAC;YACtC,MAAM,MAAM,OAAO,UAAU,CAAC;YAC9B,IAAI,CAAC,KAAK;gBAAE,QAAQ;gBAAO;YAAQ;YACnC,MAAM,OAAiC;YACvC,MAAM,SAAS,iBAAiB,SAAS,IAAI;YAC7C,MAAM,YAAY,OAAO,gBAAgB,CAAC,mBAAmB;YAC7D,MAAM,aAAa,OAAO,gBAAgB,CAAC,oBAAoB;YAC/D,MAAM,QAAQ;YACd,MAAM,SAAS;YACf,OAAO,KAAK,GAAG;YACf,OAAO,MAAM,GAAG;YAEhB,gCAAgC;YAChC,MAAM,WAAW,KAAK,oBAAoB,CAAC,GAAG,GAAG,GAAG;YACpD,SAAS,YAAY,CAAC,GAAG;YACzB,SAAS,YAAY,CAAC,GAAG;YACzB,KAAK,SAAS,GAAG;YACjB,KAAK,QAAQ,CAAC,GAAG,GAAG,OAAO;YAE3B,YAAY;YACZ,KAAK,SAAS,GAAG;YACjB,KAAK,QAAQ,CAAC,GAAG,GAAG,OAAO;YAC3B,KAAK,SAAS,GAAG;YACjB,KAAK,IAAI,GAAG,CAAC,KAAK,EAAE,WAAW;YAC/B,KAAK,SAAS,GAAG;YACjB,KAAK,YAAY,GAAG;YACpB,KAAK,QAAQ,CAAC,mCAAmC,QAAQ,GAAG;YAE5D,kBAAkB;YAClB,MAAM,cAAc,CAAC;gBACnB,MAAM,UAAU,SAAS;gBACzB,MAAM,oBAAoB;gBAE1B,KAAK,IAAI,GAAG;gBACZ,KAAK,SAAS,GAAG;gBACjB,KAAK,SAAS,GAAG;gBACjB,KAAK,YAAY,GAAG;gBAEpB,MAAM,aAAa;gBACnB,MAAM,cAAc,KAAK,WAAW,CAAC;gBACrC,MAAM,QAAQ,QAAQ;gBACtB,KAAK,QAAQ,CAAC,YAAY,OAAO;gBAEjC,MAAM,WAAW;gBACjB,MAAM,cAAc;gBACpB,MAAM,QAAQ,QAAQ,YAAY,KAAK,GAAG,cAAc;gBACxD,MAAM,QAAQ,UAAW,WAAW;gBAEpC,MAAM,UAAU,IAAI;gBACpB,QAAQ,MAAM,GAAG;oBACf,KAAK,SAAS,CAAC,SAAS,OAAO,OAAO,UAAU;oBAChD;gBACF;gBACA,QAAQ,OAAO,GAAG;gBAClB,QAAQ,GAAG,GAAG;gBAEd,SAAS;oBACP,KAAK,SAAS,GAAG;oBACjB,KAAK,IAAI,GAAG;oBACZ,KAAK,SAAS,GAAG;oBACjB,KAAK,YAAY,GAAG;oBACpB,KAAK,QAAQ,CAAC,CAAC,CAAC,EAAE,KAAK,QAAQ,EAAE,EAAE,IAAI,SAAS;oBAEhD,KAAK,SAAS,GAAG;oBACjB,KAAK,IAAI,GAAG,CAAC,KAAK,EAAE,YAAY;oBAChC,KAAK,SAAS,GAAG;oBACjB,MAAM,UAAU;oBAChB,MAAM,QAAQ,QAAQ;oBACtB,MAAM,QAAQ,UAAW,MAAM,UAAU,KAAM;oBAC/C,MAAM,WAAW;oBACjB,MAAM,aAAa;oBACnB,MAAM,QAAQ,MAAM,KAAK,CAAC;oBAC1B,IAAI,OAAO;oBACX,IAAI,IAAI;oBACR,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,MAAM,EAAE,IAAK;wBACrC,MAAM,WAAW,OAAO,KAAK,CAAC,EAAE,GAAG;wBACnC,MAAM,UAAU,KAAK,WAAW,CAAC;wBACjC,MAAM,YAAY,QAAQ,KAAK;wBAC/B,IAAI,YAAY,YAAY,IAAI,GAAG;4BACjC,KAAK,QAAQ,CAAC,MAAM,OAAO;4BAC3B,OAAO,KAAK,CAAC,EAAE,GAAG;4BAClB,KAAK;wBACP,OAAO;4BACL,OAAO;wBACT;oBACF;oBACA,KAAK,QAAQ,CAAC,MAAM,OAAO;oBAC3B,OAAO,MAAM,CAAC,CAAC;wBACb,QAAQ;oBACV,GAAG;gBACL;YACF;YAEA,IAAI,SAAS;gBACX,MAAM,MAAM,IAAI;gBAChB,IAAI,WAAW,GAAG;gBAClB,IAAI,MAAM,GAAG;oBACX,MAAM,UAAU;oBAChB,MAAM,KAAK,QAAQ;oBACnB,MAAM,KAAK,MAAO,UAAU;oBAC5B,KAAK,IAAI;oBACT,KAAK,SAAS,CAAC,IAAI;oBACnB,KAAK,MAAM,CAAC,CAAC,IAAI,KAAK,EAAE,GAAG;oBAC3B,KAAK,WAAW,GAAG;oBACnB,KAAK,UAAU,GAAG;oBAClB,KAAK,SAAS,CAAC,KAAK,CAAC,UAAQ,GAAG,CAAC,UAAQ,GAAG,SAAS;oBACrD,KAAK,UAAU,GAAG;oBAClB,KAAK,WAAW,GAAG;oBACnB,KAAK,SAAS,GAAG;oBACjB,KAAK,UAAU,CAAC,CAAC,UAAQ,GAAG,CAAC,UAAQ,GAAG,SAAS;oBACjD,KAAK,OAAO;oBACZ,YAAY;gBACd;gBACA,IAAI,OAAO,GAAG;oBAAQ;gBAAe;gBACrC,IAAI,GAAG,GAAG;YACZ,OAAO;gBACL;YACF;QACF;IACF;IAEA,MAAM,cAAc;QAClB,qCAAqC;QACrC,IAAI,aAAa;QAEjB,aAAa;QACb,iBAAiB;QAEjB,IAAI;YACF,MAAM,YAAY,MAAM;YACxB,IAAI,CAAC,WAAW,MAAM,IAAI,MAAM;YAEhC,iBAAiB;YACjB,MAAM,WAAW,CAAC,MAAM,EAAE,KAAK,QAAQ,CAAC,CAAC,EAAE,KAAK,GAAG,GAAG,IAAI,CAAC;YAC3D,MAAM,WAAW,IAAI;YACrB,SAAS,MAAM,CAAC,QAAQ,WAAW;YACnC,SAAS,MAAM,CAAC,YAAY;YAE5B,MAAM,iBAAiB,MAAM,IAAA,uKAAiB,EAAC;YAE/C,IAAI,UAAU;YACd,MAAM,iBAAiB;YACvB,IAAI,kBAAkB,eAAe,WAAW,OAAO,KAAK,QAAQ,CAAC,WAAW,IAAI;gBACjF,UAAU,CAAC,CAAC,EAAE,eAAe,eAAe,EAAE,KAAK,QAAQ,CAAC,oDAAoD,CAAC;YACpH,OAAO;gBACJ,UAAU,CAAC,CAAC,EAAE,KAAK,QAAQ,CAAC,iDAAiD,CAAC;YACjF;YACA,WAAW,CAAC,cAAc,EAAE,gBAAgB;YAE5C,IAAI;gBACF,MAAM,0VAAG,CAAC,OAAO,CAAC,WAAW,CAAC;oBAC5B,MAAM;oBACN,QAAQ;wBAAC;wBAAgB;qBAAqB;gBAChD;gBACA,iBAAiB;YACnB,EAAE,OAAO,UAAU;gBACjB,QAAQ,IAAI,CAAC,kCAAkC;gBAC/C,MAAM,MAAM,IAAI,eAAe,CAAC;gBAChC,MAAM,OAAO,SAAS,aAAa,CAAC;gBACpC,KAAK,IAAI,GAAG;gBACZ,KAAK,QAAQ,GAAG,CAAC,QAAQ,EAAE,KAAK,QAAQ,CAAC,IAAI,CAAC;gBAC9C,SAAS,IAAI,CAAC,WAAW,CAAC;gBAC1B,KAAK,KAAK;gBACV,SAAS,IAAI,CAAC,WAAW,CAAC;gBAC1B,IAAI,eAAe,CAAC;gBACpB,iBAAiB;YACnB;YAEA,aAAa;YACb,WAAW,IAAM,iBAAiB,OAAO;QAE3C,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,gBAAgB;YAC9B,aAAa;YACb,iBAAiB;QACnB;IACF;IAEA,MAAM,qBAAqB;QACzB,UAAU,IAAI,KAAK,EAAE;QACrB,WAAW,IAAM,WAAW;IAC9B;IAEA,MAAM,WAAW,kBACf,+YAAC;YAAI,KAAK;YAAe,KAAI;YAAe,WAAU;;;;;;IAGxD,qBACE,+YAAC;QAAI,WAAU;kBACb,cAAA,+YAAC;YAAI,WAAU;;8BAGb,+YAAC;oBAAI,WAAU;8BACV,cAAA,+YAAC;wBAAG,WAAU;kCAAuF;;;;;;;;;;;8BAM1G,+YAAC;oBAAI,WAAU;;sCACb,+YAAC;4BAAI,WAAU;sCACb,cAAA,+YAAC;gCACC,WAAU;gCACV,OAAO;oCAAE,YAAY;gCAAqB;0CAEzC,cAAA,+YAAC,2TAAa;8CAAE;;;;;;;;;;;;;;;;sCAIrB,+YAAC;4BAAI,WAAU;sCACZ,8BACC,+YAAC;gCAAI,WAAU;0CACZ,cAAA,+YAAC;oCAAI,WAAU;oCAAsC,OAAM;oCAA6B,MAAK;oCAAO,SAAQ;;sDACzG,+YAAC;4CAAO,WAAU;4CAAa,IAAG;4CAAK,IAAG;4CAAK,GAAE;4CAAK,QAAO;4CAAe,aAAY;;;;;;sDACxF,+YAAC;4CAAK,WAAU;4CAAa,MAAK;4CAAe,GAAE;;;;;;;;;;;;;;;;2EAGvD,wBACF,+YAAC;gCAAI,WAAU;;kDACb,+YAAC;wCAAI,WAAU;;;;;;kDACf,+YAAC;wCACC,KAAK;wCACL,KAAI;wCACJ,WAAU;;;;;;;;;;;2EAGZ;;;;;;;;;;;;8BAKR,+YAAC;oBAAI,WAAU;;sCACb,+YAAC;4BAAI,WAAU;;8CACZ,+YAAC;oCAAI,KAAK,KAAK,OAAO;oCAAE,KAAK,KAAK,QAAQ;oCAAE,WAAU;;;;;;8CACvD,+YAAC;oCAAI,WAAU;;sDACb,+YAAC;4CAAE,WAAU;;gDAA0B;gDAAE,KAAK,QAAQ;;;;;;;sDACtD,+YAAC;4CAAE,WAAU;;gDAAwB;gDAAM,KAAK,GAAG;;;;;;;;;;;;;;;;;;;sCAGvD,+YAAC;4BAAI,WAAU;;8CACb,+YAAC;;;;;8CACD,+YAAC;oCAAI,WAAU;8CACZ,cAAA,+YAAC;kDAAE;;;;;;;;;;;;;;;;;;;;;;;8BAMV,+YAAC;oBAAI,WAAU;;wBACZ,+BACE,+YAAC;4BAAI,WAAU;sCACZ;;;;;;sCAGN,+YAAC,sIAAM;4BAAC,SAAQ;4BAAU,SAAS;4BAAoB,WAAU;sCAAoB;;;;;;sCAGrF,+YAAC,sIAAM;4BAAC,SAAS;4BAAa,WAAW;4BAAW,WAAU;sCAAoD;;;;;;;;;;;;;;;;;;;;;;;AAO5H"}},
    {"offset": {"line": 881, "column": 0}, "map": {"version":3,"sources":["file:///home/tee/projects/personal/farcaster/roasted/src/app/actions.tsx"],"sourcesContent":["'use server';\n\nimport { GoogleGenAI } from \"@google/genai\";\nimport { put } from \"@vercel/blob\";\nimport Replicate from \"replicate\";\n\n// --- Types ---\nexport interface FarcasterUser {\n  fid: number;\n  username: string;\n  display_name: string;\n  pfp_url: string;\n  profile: { bio: { text: string } };\n  follower_count: number;\n  following_count: number;\n}\n\nexport interface Cast {\n  hash: string;\n  text: string;\n  parent_hash: string | null;\n  timestamp: string;\n  reactions: { likes_count: number; recasts_count: number };\n}\n\n// --- Configuration ---\n// Note: In Server Actions, process.env vars (without NEXT_PUBLIC) are secure.\nconst GEMINI_API_KEY = process.env.GEMINI_API_KEY || \"\";\nconst NEYNAR_API_KEY = process.env.NEYNAR_API_KEY || \"\";\nconst NEYNAR_API_URL = process.env.NEYNAR_API_URL || \"https://api.neynar.com/v2/farcaster\";\n\n// --- ACTION 1: Fetch User Data (Neynar) ---\nexport async function fetchUserDataAction(username: string): Promise<{\n  success: boolean;\n  user?: FarcasterUser;\n  castTexts?: string;\n  replyTexts?: string;\n  error?: string;\n}> {\n  try {\n    if (!NEYNAR_API_KEY) throw new Error(\"Missing NEYNAR_API_KEY in .env.local\");\n\n    const cleanUsername = username.replace(/^@/, '').trim().toLowerCase();\n\n    // 1. Fetch User\n    const userRes = await fetch(\n      `${NEYNAR_API_URL}/user/by_username?username=${cleanUsername}&viewer_fid=3`,\n      { headers: { 'accept': 'application/json', 'api_key': NEYNAR_API_KEY }, cache: 'no-store' }\n    );\n\n    if (!userRes.ok) {\n      if (userRes.status === 404) throw new Error(`User @${cleanUsername} not found.`);\n      if (userRes.status === 429) throw new Error(\"Neynar Rate limit hit. Wait a minute.\");\n      throw new Error(\"Failed to fetch user profile.\");\n    }\n    \n    const userData = await userRes.json();\n    const user = userData.user as FarcasterUser;\n\n    // 2. Fetch Casts (Limit 30, include replies)\n    const castsRes = await fetch(\n      `${NEYNAR_API_URL}/feed/user/casts?fid=${user.fid}&limit=30&include_replies=true&include_recasts=false`,\n      { headers: { 'accept': 'application/json', 'api_key': NEYNAR_API_KEY }, cache: 'no-store' }\n    );\n\n    let castTexts = \"\";\n    let replyTexts = \"\";\n\n    if (castsRes.ok) {\n      const castsData = await castsRes.json();\n      const allCasts = (castsData.casts || []) as Cast[];\n      \n      const primaryCasts = allCasts.filter(c => !c.parent_hash);\n      const replies = allCasts.filter(c => c.parent_hash);\n\n      castTexts = primaryCasts.slice(0, 15).map(c => `- ${c.text} (Likes: ${c.reactions.likes_count})`).join('\\n');\n      replyTexts = replies.slice(0, 15).map(c => `- ${c.text}`).join('\\n');\n    }\n\n    return { success: true, user, castTexts, replyTexts };\n\n  } catch (error: any) {\n    console.error('Fetch User Error:', error);\n    return { success: false, error: error.message || 'Server error' };\n  }\n}\n\n// --- ACTION 2: Generate Roast (Gemini) ---\nexport async function generateRoastAction(\n  user: FarcasterUser, \n  castTexts: string, \n  replyTexts: string\n): Promise<{ success: boolean; roast?: string; error?: string }> {\n  try {\n    if (!GEMINI_API_KEY) throw new Error(\"Missing GEMINI_API_KEY in .env.local\");\n    const ai = new GoogleGenAI({ apiKey: GEMINI_API_KEY });\n\n    const ratio = user.follower_count > 0 \n      ? (user.following_count / user.follower_count * 100).toFixed(0) \n      : \"0\";\n\n    const prompt = `\n      ROAST TARGET: Farcaster User @${user.username} (${user.display_name})\n      Bio: \"${user.profile.bio.text}\"\n      Followers: ${user.follower_count} | Following: ${user.following_count} (${ratio}% ratio üíÄ)\n\n      RECENT 90-DAY ACTIVITY (casts + ALL replies - dig for self-owns):\n      ${castTexts}\n      ${replyTexts ? `\\nTHEIR REPLIES (Expose these):\\n${replyTexts}` : '\\nNO REPLIES (ghost account vibes)'}\n\n      CRINGE AUDIT - EXPOSE THESE FIRST:\n      1. **Bio Cringe**: Tryhard keywords, emoji spam, humblebrags, \"DM for collabs\"\n      2. **Follower Ratio**: <10% = desperate followback farmer. >200% = spammer\n      3. **Content Patterns**: \n         - \"gm/fren/wagmi\" count >3 = braindead crypto zombie\n         - Replybegging (\"LFG @vitalik üëÄ\", ratio replies > casts)\n         - Self-quotes, \"just minted\" spam, \"who's building?\" virtue signals\n         - Copy-paste thought-leader diarrhea\n      4. **Engagement Whoring**: Likes-begging, \"drop below\", dead threads\n\n      TASK: Deliver STAND-UP COMEDIAN HECKLER ROAST (60 words max)\n      - Savage. Personal. Hit their deepest insecurity.\n      - Structure: Opening punch ‚Üí Cringe expose ‚Üí Brutal closer\n      - Voice: Don Rickles meets @basedjester\n      - NO hashtags, disclaimers, mercy.\n    `;\n\n    const roastRes = await ai.models.generateContent({\n      model: 'gemini-2.5-flash',\n      contents: prompt,\n      config: {\n        systemInstruction: \"You are a savage, ruthless roast master. You speak in a flowing, witty, and devastating manner. You do not list points, you weave them into a single brutal paragraph.\",\n        temperature: 1.1,\n      }\n    });\n\n    const roast = roastRes.text || \"You're too boring to roast.\";\n    return { success: true, roast };\n\n  } catch (error: any) {\n    console.error('Roast Gen Error:', error);\n    return { success: false, error: error.message || 'Server error' };\n  }\n}\n\n\n\n// --- ACTION 3: Generate Meme (Using Replicate) ---\nexport async function generateMemeAction(user: FarcasterUser, roast: string): Promise<{\n  success: boolean;\n  memeUrl?: string;\n  error?: string;\n}> {\n  try {\n    if (!process.env.REPLICATE_API_TOKEN) {\n      throw new Error(\"Missing REPLICATE_API_TOKEN\");\n    }\n\n    const replicate = new Replicate({\n      auth: process.env.REPLICATE_API_TOKEN,\n    });\n\n    console.log(\"Distorting PFP using Instruct-Pix2Pix:\", user.username);\n\n    // Prompt: Instructions for how to change the face\n    const prompt = `\n      Turn this person into a crying clown. \n      Apply a deep fried meme filter. \n      Make the face look devastated, melting, and roasted.\n      Context: ${roast.slice(0, 30)}\n    `;\n\n    // MODEL: Instruct-Pix2Pix\n    // This is the ONLY fast model that reliably edits faces instead of replacing them.\n    const output = await replicate.run(\n      \"timothybrooks/instruct-pix2pix:30c1d0b916a6f8efce20493f5d61ee27491ab2a60437c13c588468b9810ec23f\",\n      {\n        input: {\n          image: user.pfp_url,    // ‚úÖ The PFP goes here\n          prompt: prompt,         // ‚úÖ The command goes here\n          image_guidance_scale: 1.5, // 1.5 = Keep face shape, but change texture\n          num_inference_steps: 20,\n        }\n      }\n    );\n\n    const memeUrl = Array.isArray(output) ? String(output[0]) : String(output);\n\n    return { success: true, memeUrl };\n\n  } catch (error: any) {\n    console.error(\"Replicate Error:\", error);\n    return { success: true, memeUrl: user.pfp_url }; // Fallback to original PFP\n  }\n}\n\n// --- ACTION 4: Upload Image to Vercel Blob ---\nexport async function uploadImageAction(formData: FormData): Promise<string> {\n  const file = formData.get('file') as File;\n  const filename = formData.get('filename') as string;\n\n  if (!file) {\n    throw new Error('No file provided');\n  }\n\n  // Upload to Vercel Blob\n  const blob = await put(filename, file, {\n    access: 'public',\n  });\n\n  return blob.url; // Returns the https://... public URL\n}"],"names":[],"mappings":";;;;;;;IAwFsB,sBAAA,WAAA,GAAA,IAAA,gZAAA,EAAA,8CAAA,qYAAA,EAAA,KAAA,GAAA,2YAAA,EAAA"}},
    {"offset": {"line": 893, "column": 0}, "map": {"version":3,"sources":["file:///home/tee/projects/personal/farcaster/roasted/src/app/actions.tsx"],"sourcesContent":["'use server';\n\nimport { GoogleGenAI } from \"@google/genai\";\nimport { put } from \"@vercel/blob\";\nimport Replicate from \"replicate\";\n\n// --- Types ---\nexport interface FarcasterUser {\n  fid: number;\n  username: string;\n  display_name: string;\n  pfp_url: string;\n  profile: { bio: { text: string } };\n  follower_count: number;\n  following_count: number;\n}\n\nexport interface Cast {\n  hash: string;\n  text: string;\n  parent_hash: string | null;\n  timestamp: string;\n  reactions: { likes_count: number; recasts_count: number };\n}\n\n// --- Configuration ---\n// Note: In Server Actions, process.env vars (without NEXT_PUBLIC) are secure.\nconst GEMINI_API_KEY = process.env.GEMINI_API_KEY || \"\";\nconst NEYNAR_API_KEY = process.env.NEYNAR_API_KEY || \"\";\nconst NEYNAR_API_URL = process.env.NEYNAR_API_URL || \"https://api.neynar.com/v2/farcaster\";\n\n// --- ACTION 1: Fetch User Data (Neynar) ---\nexport async function fetchUserDataAction(username: string): Promise<{\n  success: boolean;\n  user?: FarcasterUser;\n  castTexts?: string;\n  replyTexts?: string;\n  error?: string;\n}> {\n  try {\n    if (!NEYNAR_API_KEY) throw new Error(\"Missing NEYNAR_API_KEY in .env.local\");\n\n    const cleanUsername = username.replace(/^@/, '').trim().toLowerCase();\n\n    // 1. Fetch User\n    const userRes = await fetch(\n      `${NEYNAR_API_URL}/user/by_username?username=${cleanUsername}&viewer_fid=3`,\n      { headers: { 'accept': 'application/json', 'api_key': NEYNAR_API_KEY }, cache: 'no-store' }\n    );\n\n    if (!userRes.ok) {\n      if (userRes.status === 404) throw new Error(`User @${cleanUsername} not found.`);\n      if (userRes.status === 429) throw new Error(\"Neynar Rate limit hit. Wait a minute.\");\n      throw new Error(\"Failed to fetch user profile.\");\n    }\n    \n    const userData = await userRes.json();\n    const user = userData.user as FarcasterUser;\n\n    // 2. Fetch Casts (Limit 30, include replies)\n    const castsRes = await fetch(\n      `${NEYNAR_API_URL}/feed/user/casts?fid=${user.fid}&limit=30&include_replies=true&include_recasts=false`,\n      { headers: { 'accept': 'application/json', 'api_key': NEYNAR_API_KEY }, cache: 'no-store' }\n    );\n\n    let castTexts = \"\";\n    let replyTexts = \"\";\n\n    if (castsRes.ok) {\n      const castsData = await castsRes.json();\n      const allCasts = (castsData.casts || []) as Cast[];\n      \n      const primaryCasts = allCasts.filter(c => !c.parent_hash);\n      const replies = allCasts.filter(c => c.parent_hash);\n\n      castTexts = primaryCasts.slice(0, 15).map(c => `- ${c.text} (Likes: ${c.reactions.likes_count})`).join('\\n');\n      replyTexts = replies.slice(0, 15).map(c => `- ${c.text}`).join('\\n');\n    }\n\n    return { success: true, user, castTexts, replyTexts };\n\n  } catch (error: any) {\n    console.error('Fetch User Error:', error);\n    return { success: false, error: error.message || 'Server error' };\n  }\n}\n\n// --- ACTION 2: Generate Roast (Gemini) ---\nexport async function generateRoastAction(\n  user: FarcasterUser, \n  castTexts: string, \n  replyTexts: string\n): Promise<{ success: boolean; roast?: string; error?: string }> {\n  try {\n    if (!GEMINI_API_KEY) throw new Error(\"Missing GEMINI_API_KEY in .env.local\");\n    const ai = new GoogleGenAI({ apiKey: GEMINI_API_KEY });\n\n    const ratio = user.follower_count > 0 \n      ? (user.following_count / user.follower_count * 100).toFixed(0) \n      : \"0\";\n\n    const prompt = `\n      ROAST TARGET: Farcaster User @${user.username} (${user.display_name})\n      Bio: \"${user.profile.bio.text}\"\n      Followers: ${user.follower_count} | Following: ${user.following_count} (${ratio}% ratio üíÄ)\n\n      RECENT 90-DAY ACTIVITY (casts + ALL replies - dig for self-owns):\n      ${castTexts}\n      ${replyTexts ? `\\nTHEIR REPLIES (Expose these):\\n${replyTexts}` : '\\nNO REPLIES (ghost account vibes)'}\n\n      CRINGE AUDIT - EXPOSE THESE FIRST:\n      1. **Bio Cringe**: Tryhard keywords, emoji spam, humblebrags, \"DM for collabs\"\n      2. **Follower Ratio**: <10% = desperate followback farmer. >200% = spammer\n      3. **Content Patterns**: \n         - \"gm/fren/wagmi\" count >3 = braindead crypto zombie\n         - Replybegging (\"LFG @vitalik üëÄ\", ratio replies > casts)\n         - Self-quotes, \"just minted\" spam, \"who's building?\" virtue signals\n         - Copy-paste thought-leader diarrhea\n      4. **Engagement Whoring**: Likes-begging, \"drop below\", dead threads\n\n      TASK: Deliver STAND-UP COMEDIAN HECKLER ROAST (60 words max)\n      - Savage. Personal. Hit their deepest insecurity.\n      - Structure: Opening punch ‚Üí Cringe expose ‚Üí Brutal closer\n      - Voice: Don Rickles meets @basedjester\n      - NO hashtags, disclaimers, mercy.\n    `;\n\n    const roastRes = await ai.models.generateContent({\n      model: 'gemini-2.5-flash',\n      contents: prompt,\n      config: {\n        systemInstruction: \"You are a savage, ruthless roast master. You speak in a flowing, witty, and devastating manner. You do not list points, you weave them into a single brutal paragraph.\",\n        temperature: 1.1,\n      }\n    });\n\n    const roast = roastRes.text || \"You're too boring to roast.\";\n    return { success: true, roast };\n\n  } catch (error: any) {\n    console.error('Roast Gen Error:', error);\n    return { success: false, error: error.message || 'Server error' };\n  }\n}\n\n\n\n// --- ACTION 3: Generate Meme (Using Replicate) ---\nexport async function generateMemeAction(user: FarcasterUser, roast: string): Promise<{\n  success: boolean;\n  memeUrl?: string;\n  error?: string;\n}> {\n  try {\n    if (!process.env.REPLICATE_API_TOKEN) {\n      throw new Error(\"Missing REPLICATE_API_TOKEN\");\n    }\n\n    const replicate = new Replicate({\n      auth: process.env.REPLICATE_API_TOKEN,\n    });\n\n    console.log(\"Distorting PFP using Instruct-Pix2Pix:\", user.username);\n\n    // Prompt: Instructions for how to change the face\n    const prompt = `\n      Turn this person into a crying clown. \n      Apply a deep fried meme filter. \n      Make the face look devastated, melting, and roasted.\n      Context: ${roast.slice(0, 30)}\n    `;\n\n    // MODEL: Instruct-Pix2Pix\n    // This is the ONLY fast model that reliably edits faces instead of replacing them.\n    const output = await replicate.run(\n      \"timothybrooks/instruct-pix2pix:30c1d0b916a6f8efce20493f5d61ee27491ab2a60437c13c588468b9810ec23f\",\n      {\n        input: {\n          image: user.pfp_url,    // ‚úÖ The PFP goes here\n          prompt: prompt,         // ‚úÖ The command goes here\n          image_guidance_scale: 1.5, // 1.5 = Keep face shape, but change texture\n          num_inference_steps: 20,\n        }\n      }\n    );\n\n    const memeUrl = Array.isArray(output) ? String(output[0]) : String(output);\n\n    return { success: true, memeUrl };\n\n  } catch (error: any) {\n    console.error(\"Replicate Error:\", error);\n    return { success: true, memeUrl: user.pfp_url }; // Fallback to original PFP\n  }\n}\n\n// --- ACTION 4: Upload Image to Vercel Blob ---\nexport async function uploadImageAction(formData: FormData): Promise<string> {\n  const file = formData.get('file') as File;\n  const filename = formData.get('filename') as string;\n\n  if (!file) {\n    throw new Error('No file provided');\n  }\n\n  // Upload to Vercel Blob\n  const blob = await put(filename, file, {\n    access: 'public',\n  });\n\n  return blob.url; // Returns the https://... public URL\n}"],"names":[],"mappings":";;;;;;;IAgCsB,sBAAA,WAAA,GAAA,IAAA,gZAAA,EAAA,8CAAA,qYAAA,EAAA,KAAA,GAAA,2YAAA,EAAA"}},
    {"offset": {"line": 905, "column": 0}, "map": {"version":3,"sources":["file:///home/tee/projects/personal/farcaster/roasted/src/app/actions.tsx"],"sourcesContent":["'use server';\n\nimport { GoogleGenAI } from \"@google/genai\";\nimport { put } from \"@vercel/blob\";\nimport Replicate from \"replicate\";\n\n// --- Types ---\nexport interface FarcasterUser {\n  fid: number;\n  username: string;\n  display_name: string;\n  pfp_url: string;\n  profile: { bio: { text: string } };\n  follower_count: number;\n  following_count: number;\n}\n\nexport interface Cast {\n  hash: string;\n  text: string;\n  parent_hash: string | null;\n  timestamp: string;\n  reactions: { likes_count: number; recasts_count: number };\n}\n\n// --- Configuration ---\n// Note: In Server Actions, process.env vars (without NEXT_PUBLIC) are secure.\nconst GEMINI_API_KEY = process.env.GEMINI_API_KEY || \"\";\nconst NEYNAR_API_KEY = process.env.NEYNAR_API_KEY || \"\";\nconst NEYNAR_API_URL = process.env.NEYNAR_API_URL || \"https://api.neynar.com/v2/farcaster\";\n\n// --- ACTION 1: Fetch User Data (Neynar) ---\nexport async function fetchUserDataAction(username: string): Promise<{\n  success: boolean;\n  user?: FarcasterUser;\n  castTexts?: string;\n  replyTexts?: string;\n  error?: string;\n}> {\n  try {\n    if (!NEYNAR_API_KEY) throw new Error(\"Missing NEYNAR_API_KEY in .env.local\");\n\n    const cleanUsername = username.replace(/^@/, '').trim().toLowerCase();\n\n    // 1. Fetch User\n    const userRes = await fetch(\n      `${NEYNAR_API_URL}/user/by_username?username=${cleanUsername}&viewer_fid=3`,\n      { headers: { 'accept': 'application/json', 'api_key': NEYNAR_API_KEY }, cache: 'no-store' }\n    );\n\n    if (!userRes.ok) {\n      if (userRes.status === 404) throw new Error(`User @${cleanUsername} not found.`);\n      if (userRes.status === 429) throw new Error(\"Neynar Rate limit hit. Wait a minute.\");\n      throw new Error(\"Failed to fetch user profile.\");\n    }\n    \n    const userData = await userRes.json();\n    const user = userData.user as FarcasterUser;\n\n    // 2. Fetch Casts (Limit 30, include replies)\n    const castsRes = await fetch(\n      `${NEYNAR_API_URL}/feed/user/casts?fid=${user.fid}&limit=30&include_replies=true&include_recasts=false`,\n      { headers: { 'accept': 'application/json', 'api_key': NEYNAR_API_KEY }, cache: 'no-store' }\n    );\n\n    let castTexts = \"\";\n    let replyTexts = \"\";\n\n    if (castsRes.ok) {\n      const castsData = await castsRes.json();\n      const allCasts = (castsData.casts || []) as Cast[];\n      \n      const primaryCasts = allCasts.filter(c => !c.parent_hash);\n      const replies = allCasts.filter(c => c.parent_hash);\n\n      castTexts = primaryCasts.slice(0, 15).map(c => `- ${c.text} (Likes: ${c.reactions.likes_count})`).join('\\n');\n      replyTexts = replies.slice(0, 15).map(c => `- ${c.text}`).join('\\n');\n    }\n\n    return { success: true, user, castTexts, replyTexts };\n\n  } catch (error: any) {\n    console.error('Fetch User Error:', error);\n    return { success: false, error: error.message || 'Server error' };\n  }\n}\n\n// --- ACTION 2: Generate Roast (Gemini) ---\nexport async function generateRoastAction(\n  user: FarcasterUser, \n  castTexts: string, \n  replyTexts: string\n): Promise<{ success: boolean; roast?: string; error?: string }> {\n  try {\n    if (!GEMINI_API_KEY) throw new Error(\"Missing GEMINI_API_KEY in .env.local\");\n    const ai = new GoogleGenAI({ apiKey: GEMINI_API_KEY });\n\n    const ratio = user.follower_count > 0 \n      ? (user.following_count / user.follower_count * 100).toFixed(0) \n      : \"0\";\n\n    const prompt = `\n      ROAST TARGET: Farcaster User @${user.username} (${user.display_name})\n      Bio: \"${user.profile.bio.text}\"\n      Followers: ${user.follower_count} | Following: ${user.following_count} (${ratio}% ratio üíÄ)\n\n      RECENT 90-DAY ACTIVITY (casts + ALL replies - dig for self-owns):\n      ${castTexts}\n      ${replyTexts ? `\\nTHEIR REPLIES (Expose these):\\n${replyTexts}` : '\\nNO REPLIES (ghost account vibes)'}\n\n      CRINGE AUDIT - EXPOSE THESE FIRST:\n      1. **Bio Cringe**: Tryhard keywords, emoji spam, humblebrags, \"DM for collabs\"\n      2. **Follower Ratio**: <10% = desperate followback farmer. >200% = spammer\n      3. **Content Patterns**: \n         - \"gm/fren/wagmi\" count >3 = braindead crypto zombie\n         - Replybegging (\"LFG @vitalik üëÄ\", ratio replies > casts)\n         - Self-quotes, \"just minted\" spam, \"who's building?\" virtue signals\n         - Copy-paste thought-leader diarrhea\n      4. **Engagement Whoring**: Likes-begging, \"drop below\", dead threads\n\n      TASK: Deliver STAND-UP COMEDIAN HECKLER ROAST (60 words max)\n      - Savage. Personal. Hit their deepest insecurity.\n      - Structure: Opening punch ‚Üí Cringe expose ‚Üí Brutal closer\n      - Voice: Don Rickles meets @basedjester\n      - NO hashtags, disclaimers, mercy.\n    `;\n\n    const roastRes = await ai.models.generateContent({\n      model: 'gemini-2.5-flash',\n      contents: prompt,\n      config: {\n        systemInstruction: \"You are a savage, ruthless roast master. You speak in a flowing, witty, and devastating manner. You do not list points, you weave them into a single brutal paragraph.\",\n        temperature: 1.1,\n      }\n    });\n\n    const roast = roastRes.text || \"You're too boring to roast.\";\n    return { success: true, roast };\n\n  } catch (error: any) {\n    console.error('Roast Gen Error:', error);\n    return { success: false, error: error.message || 'Server error' };\n  }\n}\n\n\n\n// --- ACTION 3: Generate Meme (Using Replicate) ---\nexport async function generateMemeAction(user: FarcasterUser, roast: string): Promise<{\n  success: boolean;\n  memeUrl?: string;\n  error?: string;\n}> {\n  try {\n    if (!process.env.REPLICATE_API_TOKEN) {\n      throw new Error(\"Missing REPLICATE_API_TOKEN\");\n    }\n\n    const replicate = new Replicate({\n      auth: process.env.REPLICATE_API_TOKEN,\n    });\n\n    console.log(\"Distorting PFP using Instruct-Pix2Pix:\", user.username);\n\n    // Prompt: Instructions for how to change the face\n    const prompt = `\n      Turn this person into a crying clown. \n      Apply a deep fried meme filter. \n      Make the face look devastated, melting, and roasted.\n      Context: ${roast.slice(0, 30)}\n    `;\n\n    // MODEL: Instruct-Pix2Pix\n    // This is the ONLY fast model that reliably edits faces instead of replacing them.\n    const output = await replicate.run(\n      \"timothybrooks/instruct-pix2pix:30c1d0b916a6f8efce20493f5d61ee27491ab2a60437c13c588468b9810ec23f\",\n      {\n        input: {\n          image: user.pfp_url,    // ‚úÖ The PFP goes here\n          prompt: prompt,         // ‚úÖ The command goes here\n          image_guidance_scale: 1.5, // 1.5 = Keep face shape, but change texture\n          num_inference_steps: 20,\n        }\n      }\n    );\n\n    const memeUrl = Array.isArray(output) ? String(output[0]) : String(output);\n\n    return { success: true, memeUrl };\n\n  } catch (error: any) {\n    console.error(\"Replicate Error:\", error);\n    return { success: true, memeUrl: user.pfp_url }; // Fallback to original PFP\n  }\n}\n\n// --- ACTION 4: Upload Image to Vercel Blob ---\nexport async function uploadImageAction(formData: FormData): Promise<string> {\n  const file = formData.get('file') as File;\n  const filename = formData.get('filename') as string;\n\n  if (!file) {\n    throw new Error('No file provided');\n  }\n\n  // Upload to Vercel Blob\n  const blob = await put(filename, file, {\n    access: 'public',\n  });\n\n  return blob.url; // Returns the https://... public URL\n}"],"names":[],"mappings":";;;;;;;IAoJsB,qBAAA,WAAA,GAAA,IAAA,gZAAA,EAAA,8CAAA,qYAAA,EAAA,KAAA,GAAA,2YAAA,EAAA"}},
    {"offset": {"line": 917, "column": 0}, "map": {"version":3,"sources":["file:///home/tee/projects/personal/farcaster/roasted/src/app/page.tsx"],"sourcesContent":["\n'use client';\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { UserSearch } from '../components/UserSearch';\nimport { RoastCard } from '../components/RoastCard';\nimport { Button } from '../components/Button';\nimport { RoastState } from '../types';\nimport { generateRoastAction, fetchUserDataAction, generateMemeAction } from './actions';\nimport { sdk } from \"@farcaster/miniapp-sdk\"; \n\n// ‚úÖ Local Files\nconst LOADING_MUSIC_URL = \"/sounds/loading.wav\"; \nconst SUCCESS_SFX_URL = \"/sounds/success.wav\";\n\nconst LOADING_MESSAGES = [\n  \"This dude seems to be hiding something...\",\n  \"Scanning for cringe...\",\n  \"Analyzing bad takes...\",\n  \"Consulting the roast gods...\",\n  \"Sharpening the knives...\",\n  \"Hmm, I'm gonna find out real soon...\",\n  \"Checking for degraded performance...\",\n  \"Reading between the lines...\"\n];\n\nexport default function Home() {\n  const [showSplash, setShowSplash] = useState(true);\n  const [state, setState] = useState<RoastState>({\n    status: 'idle',\n    user: null,\n    roast: null,\n    memeUrl: null,\n    isMemeLoading: false,\n    error: null,\n  });\n  const [isReady, setIsReady] = useState(false);\n  const [context, setContext] = useState<any>(); \n  \n  const [loadingMessage, setLoadingMessage] = useState(\"Cooking up something spicy...\");\n  \n  \n  const audioRef = useRef<HTMLAudioElement | null>(null);\n  const successAudioRef = useRef<HTMLAudioElement | null>(null);\n\n  // --- 1. Initialize SDK ---\n  useEffect(() => {\n    const load = async () => {\n      try {\n        const frameContext = await sdk.context;\n        setContext(frameContext);\n        await sdk.actions.ready();\n        setIsReady(true);\n\n        // ‚úÖ REMOVED: await sdk.actions.addMiniApp();\n        // The drawer will handle this\n\n      } catch (err) {\n        console.warn(\"SDK Context failed\", err);\n        setIsReady(true);\n      }\n    };\n    if (!isReady) load();\n  }, [isReady]);\n\n useEffect(() => {\n  if (!showSplash && isReady) {\n    const timer = setTimeout(async () => {\n      try {\n        await sdk.actions.addMiniApp();\n        console.log('‚úÖ App successfully added!');\n      } catch (error: any) {\n        const errorMsg = error?.message || '';\n        if (errorMsg.includes('RejectedByUser')) {\n          console.log('User declined to add the app');\n        } else if (errorMsg.includes('InvalidDomainManifestJson')) {\n          console.error('‚ö†Ô∏è Invalid manifest or domain mismatch:', error);\n        } else {\n          console.error('Error adding mini app:', error);\n        }\n      }\n    }, 1000);\n    return () => clearTimeout(timer);\n  }\n}, [showSplash, isReady]);\n\n  // --- 2. Initialize Audio & Autoplay ---\n  useEffect(() => {\n    // Setup Audio Objects\n    if (typeof window !== 'undefined') {\n      audioRef.current = new Audio(LOADING_MUSIC_URL);\n      audioRef.current.loop = true;\n      audioRef.current.volume = 0.3;\n\n      successAudioRef.current = new Audio(SUCCESS_SFX_URL);\n      successAudioRef.current.volume = 1.0;\n\n      // Try Autoplay immediately\n      const attemptPlay = async () => {\n        try {\n          await audioRef.current?.play();\n        } catch (e) {\n          // If blocked, add a one-time click listener to start it\n          const startOnInteraction = () => {\n             audioRef.current?.play().catch(() => {});\n             document.removeEventListener('click', startOnInteraction);\n          };\n          document.addEventListener('click', startOnInteraction);\n        }\n      };\n      \n      // Only attempt play if not already complete/error\n      if (state.status === 'idle') {\n        attemptPlay();\n      }\n    }\n\n    return () => {\n      // stopBackgroundMusic();\n    };\n  }, []);\n\n  // Splash Screen Timer\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setShowSplash(false);\n    }, 2000);\n    return () => clearTimeout(timer);\n  }, []);\n\n  const stopBackgroundMusic = () => {\n    if (audioRef.current) {\n      audioRef.current.pause();\n      audioRef.current.currentTime = 0;\n    }\n  };\n\n  // Loading Messages Cycler\n  useEffect(() => {\n    const isLoading = ['fetching_user', 'analyzing', 'generating_meme'].includes(state.status);\n    let interval: any;\n\n    if (isLoading) {\n      setLoadingMessage(LOADING_MESSAGES[Math.floor(Math.random() * LOADING_MESSAGES.length)]);\n      interval = setInterval(() => {\n        setLoadingMessage(LOADING_MESSAGES[Math.floor(Math.random() * LOADING_MESSAGES.length)]);\n      }, 2500);\n    }\n    return () => { if (interval) clearInterval(interval); };\n  }, [state.status]);\n\n  const handleSearch = async (username: string) => {\n    try {\n      // Ensure music is playing if it wasn't already\n      if (audioRef.current?.paused) {\n         audioRef.current.play().catch(() => {});\n      }\n\n      setState(prev => ({ ...prev, status: 'fetching_user', error: null, memeUrl: null, isMemeLoading: false }));\n\n      const fetchResult = await fetchUserDataAction(username);\n      \n      if (!fetchResult.success || !fetchResult.user) {\n        throw new Error(fetchResult.error || \"Failed to find user\");\n      }\n\n      setState(prev => ({ ...prev, status: 'analyzing', user: fetchResult.user! }));\n\n      const roastResult = await generateRoastAction(\n        fetchResult.user, \n        fetchResult.castTexts || \"\", \n        fetchResult.replyTexts || \"\"\n      );\n\n      if (!roastResult.success || !roastResult.roast) {\n        throw new Error(roastResult.error || \"Failed to generate roast\");\n      }\n\n      // Success! Stop music, play SFX\n      // stopBackgroundMusic();\n      if (successAudioRef.current) {\n         successAudioRef.current.currentTime = 0;\n         successAudioRef.current.play().catch(() => {});\n      }\n\n      setState(prev => ({ \n        ...prev, \n        status: 'complete', \n        roast: roastResult.roast!,\n        memeUrl: null,\n        isMemeLoading: true \n      }));\n\n      generateMemeAction(fetchResult.user, roastResult.roast!)\n        .then((memeResult) => {\n           if (memeResult.success && memeResult.memeUrl) {\n             setState(prev => ({ ...prev, memeUrl: memeResult.memeUrl!, isMemeLoading: false }));\n           } else {\n             setState(prev => ({ ...prev, isMemeLoading: false }));\n           }\n        })\n        .catch(err => {\n           setState(prev => ({ ...prev, isMemeLoading: false }));\n        });\n\n    } catch (err: any) {\n      console.error(err);\n      // stopBackgroundMusic();\n      setState(prev => ({\n        ...prev,\n        status: 'error',\n        error: err.message || \"Something went wrong. Try again.\",\n        isMemeLoading: false\n      }));\n    }\n  };\n\n  const handleReset = () => {\n    // Restart music on reset\n    if (audioRef.current) {\n        audioRef.current.currentTime = 0;\n        audioRef.current.play().catch(() => {});\n    }\n    setState({\n      status: 'idle',\n      user: null,\n      roast: null,\n      memeUrl: null,\n      isMemeLoading: false,\n      error: null\n    });\n  };\n\n  // ‚úÖ YOUR ORIGINAL SVGs\n  const LogoSVG = () => (\n    <img src=\"/roasted-logo.png\" alt=\"Roasted Logo\" className=\"w-full h-full object-contain\" />\n  );\n\n  const LogoSVGHeader = () => (\n    <img src=\"/logo-header.svg\" alt=\"Roasted Header Logo\" className=\"w-full h-full object-contain\" />\n  );\n\n  const openFollowLink = () => {\n    sdk.actions.openUrl(\"https://farcaster.xyz/teesmilex.base.eth\");\n  };\n\n  if (showSplash) {\n    return (\n      <div className=\"min-h-screen animated-bg flex items-center justify-center z-50 fixed inset-0\">\n        <div className=\"w-56 h-56 rounded-2xl p-4 animate-scale-pulse drop-shadow-2xl\">\n          <LogoSVG />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"custom-cursor min-h-screen animated-bg text-white flex flex-col\">\n      <header className=\"p-6 border-b border-white/10 bg-black/20 backdrop-blur-md sticky top-0 z-10\">\n        <div className=\"max-w-5xl mx-auto flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-16 h-16 cursor-pointer p-1 rounded-lg overflow-hidden shadow-lg hover:scale-105 transition-transform\">\n              <LogoSVGHeader />\n            </div>\n            <h1 className=\"text-2xl font-bold tracking-tight drop-shadow-sm uppercase italic font-chewy\">\n              Roasted\n            </h1>\n          </div>\n          \n          <div className=\"flex items-center gap-3\">\n            <span className=\"text-sm text-white/80 hidden sm:block font-medium shadow-sm\">Built by</span>\n            <button \n              onClick={openFollowLink}\n              className=\"px-5 py-2 bg-black/40 hover:bg-black/60 border border-white/20 text-white rounded-full text-sm font-medium transition-all flex items-center gap-2 backdrop-blur-sm cursor-pointer\"\n            >\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"w-4 h-4 text-brand-300\">\n                  <path d=\"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\"></path>\n                  <circle cx=\"9\" cy=\"7\" r=\"4\"></circle>\n                  <path d=\"M22 21v-2a4 4 0 0 0-3-3.87\"></path>\n                  <path d=\"M16 3.13a4 4 0 0 1 0 7.75\"></path>\n                </svg>\n                Follow\n            </button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"flex-1 flex flex-col items-center justify-center p-4 md:p-8 pb-40 w-full max-w-5xl mx-auto\">\n        \n        {state.status === 'idle' && (\n          <UserSearch \n            onSearch={handleSearch} \n            isLoading={false}\n            initialUsername={context?.user?.username} \n          />\n        )}\n\n        {(state.status === 'fetching_user' || state.status === 'analyzing' || state.status === 'generating_meme') && (\n           // ‚úÖ YOUR ORIGINAL GRADIENT CONTAINER STRUCTURE\n           <div className=\"max-w-md w-full mx-auto animate-fade-in\">\n             <div className=\"bg-gradient-to-br from-yellow-400 via-orange-500 to-pink-500 p-1 rounded-3xl shadow-2xl\">\n               <div className=\"bg-gradient-to-br from-yellow-400 via-orange-500 to-pink-500 p-6 rounded-[1.4rem] flex flex-col items-center text-center space-y-8 min-h-[400px] justify-center\">\n                 \n                 <div className=\"w-56 h-56 rounded-2xl p-2 flex items-center justify-center transform animate-scale-pulse\">\n                    <LogoSVG />\n                 </div>\n\n                 <div className=\"space-y-3 w-full\">\n                   <h2 className=\"text-2xl text-white drop-shadow-lg tracking-wide font-chewy\">\n                     {state.status === 'fetching_user' && 'Locating Target'}\n                     {(state.status === 'analyzing' || state.status === 'generating_meme') && 'Cooking you up real soon...'}\n                   </h2>\n                   <p className=\"text-white text-base sm:text-lg drop-shadow-md min-h-[3rem] max-w-[90%] mx-auto font-chewy truncate px-2\">\n                     {loadingMessage}\n                   </p>\n                 </div>\n               </div>\n             </div>\n           </div>\n        )}\n\n        {state.status === 'complete' && state.user && state.roast && (\n          <RoastCard \n            user={state.user} \n            roast={state.roast}\n            memeUrl={state.memeUrl}\n            isMemeLoading={state.isMemeLoading}\n            viewerUsername={context?.user?.username}\n            onReset={handleReset}\n            // ‚úÖ Pass stop function to the card\n            onStopMusic={stopBackgroundMusic} \n          />\n        )}\n\n        {state.status === 'error' && (\n          <div className=\"max-w-md w-full bg-red-600/20 border border-red-400/50 backdrop-blur-md rounded-xl p-6 text-center shadow-xl\">\n             <div className=\"text-white text-5xl mb-4 drop-shadow-md\">‚ö†Ô∏è</div>\n             <h3 className=\"text-xl font-bold text-white mb-2\">Roast Failed</h3>\n             <p className=\"text-white/90 mb-6\">{state.error}</p>\n             <Button onClick={handleReset} variant=\"secondary\" className=\"w-full bg-white text-red-600 hover:bg-gray-100\">\n               Try Again\n             </Button>\n          </div>\n        )}\n\n        <footer className=\"mt-2 text-center text-white/50 text-xs font-medium drop-shadow-sm\">\n          <p>This is a fun app. Use at your own emotional risk.</p>\n        </footer>\n      </main>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AAGA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AAAA;AARA;;;;;;;;AAUA,gBAAgB;AAChB,MAAM,oBAAoB;AAC1B,MAAM,kBAAkB;AAExB,MAAM,mBAAmB;IACvB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAEc,SAAS;IACtB,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,kXAAQ,EAAC;IAC7C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,kXAAQ,EAAa;QAC7C,QAAQ;QACR,MAAM;QACN,OAAO;QACP,SAAS;QACT,eAAe;QACf,OAAO;IACT;IACA,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,kXAAQ,EAAC;IACvC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,kXAAQ;IAEtC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,kXAAQ,EAAC;IAGrD,MAAM,WAAW,IAAA,gXAAM,EAA0B;IACjD,MAAM,kBAAkB,IAAA,gXAAM,EAA0B;IAExD,4BAA4B;IAC5B,IAAA,mXAAS,EAAC;QACR,MAAM,OAAO;YACX,IAAI;gBACF,MAAM,eAAe,MAAM,0VAAG,CAAC,OAAO;gBACtC,WAAW;gBACX,MAAM,0VAAG,CAAC,OAAO,CAAC,KAAK;gBACvB,WAAW;YAEX,6CAA6C;YAC7C,8BAA8B;YAEhC,EAAE,OAAO,KAAK;gBACZ,QAAQ,IAAI,CAAC,sBAAsB;gBACnC,WAAW;YACb;QACF;QACA,IAAI,CAAC,SAAS;IAChB,GAAG;QAAC;KAAQ;IAEb,IAAA,mXAAS,EAAC;QACT,IAAI,CAAC,cAAc,SAAS;YAC1B,MAAM,QAAQ,WAAW;gBACvB,IAAI;oBACF,MAAM,0VAAG,CAAC,OAAO,CAAC,UAAU;oBAC5B,QAAQ,GAAG,CAAC;gBACd,EAAE,OAAO,OAAY;oBACnB,MAAM,WAAW,OAAO,WAAW;oBACnC,IAAI,SAAS,QAAQ,CAAC,mBAAmB;wBACvC,QAAQ,GAAG,CAAC;oBACd,OAAO,IAAI,SAAS,QAAQ,CAAC,8BAA8B;wBACzD,QAAQ,KAAK,CAAC,2CAA2C;oBAC3D,OAAO;wBACL,QAAQ,KAAK,CAAC,0BAA0B;oBAC1C;gBACF;YACF,GAAG;YACH,OAAO,IAAM,aAAa;QAC5B;IACF,GAAG;QAAC;QAAY;KAAQ;IAEtB,yCAAyC;IACzC,IAAA,mXAAS,EAAC;QACR,sBAAsB;QACtB;;QA4BA,OAAO;QACL,yBAAyB;QAC3B;IACF,GAAG,EAAE;IAEL,sBAAsB;IACtB,IAAA,mXAAS,EAAC;QACR,MAAM,QAAQ,WAAW;YACvB,cAAc;QAChB,GAAG;QACH,OAAO,IAAM,aAAa;IAC5B,GAAG,EAAE;IAEL,MAAM,sBAAsB;QAC1B,IAAI,SAAS,OAAO,EAAE;YACpB,SAAS,OAAO,CAAC,KAAK;YACtB,SAAS,OAAO,CAAC,WAAW,GAAG;QACjC;IACF;IAEA,0BAA0B;IAC1B,IAAA,mXAAS,EAAC;QACR,MAAM,YAAY;YAAC;YAAiB;YAAa;SAAkB,CAAC,QAAQ,CAAC,MAAM,MAAM;QACzF,IAAI;QAEJ,IAAI,WAAW;YACb,kBAAkB,gBAAgB,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,iBAAiB,MAAM,EAAE;YACvF,WAAW,YAAY;gBACrB,kBAAkB,gBAAgB,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,iBAAiB,MAAM,EAAE;YACzF,GAAG;QACL;QACA,OAAO;YAAQ,IAAI,UAAU,cAAc;QAAW;IACxD,GAAG;QAAC,MAAM,MAAM;KAAC;IAEjB,MAAM,eAAe,OAAO;QAC1B,IAAI;YACF,+CAA+C;YAC/C,IAAI,SAAS,OAAO,EAAE,QAAQ;gBAC3B,SAAS,OAAO,CAAC,IAAI,GAAG,KAAK,CAAC,KAAO;YACxC;YAEA,SAAS,CAAA,OAAQ,CAAC;oBAAE,GAAG,IAAI;oBAAE,QAAQ;oBAAiB,OAAO;oBAAM,SAAS;oBAAM,eAAe;gBAAM,CAAC;YAExG,MAAM,cAAc,MAAM,IAAA,yKAAmB,EAAC;YAE9C,IAAI,CAAC,YAAY,OAAO,IAAI,CAAC,YAAY,IAAI,EAAE;gBAC7C,MAAM,IAAI,MAAM,YAAY,KAAK,IAAI;YACvC;YAEA,SAAS,CAAA,OAAQ,CAAC;oBAAE,GAAG,IAAI;oBAAE,QAAQ;oBAAa,MAAM,YAAY,IAAI;gBAAE,CAAC;YAE3E,MAAM,cAAc,MAAM,IAAA,yKAAmB,EAC3C,YAAY,IAAI,EAChB,YAAY,SAAS,IAAI,IACzB,YAAY,UAAU,IAAI;YAG5B,IAAI,CAAC,YAAY,OAAO,IAAI,CAAC,YAAY,KAAK,EAAE;gBAC9C,MAAM,IAAI,MAAM,YAAY,KAAK,IAAI;YACvC;YAEA,gCAAgC;YAChC,yBAAyB;YACzB,IAAI,gBAAgB,OAAO,EAAE;gBAC1B,gBAAgB,OAAO,CAAC,WAAW,GAAG;gBACtC,gBAAgB,OAAO,CAAC,IAAI,GAAG,KAAK,CAAC,KAAO;YAC/C;YAEA,SAAS,CAAA,OAAQ,CAAC;oBAChB,GAAG,IAAI;oBACP,QAAQ;oBACR,OAAO,YAAY,KAAK;oBACxB,SAAS;oBACT,eAAe;gBACjB,CAAC;YAED,IAAA,wKAAkB,EAAC,YAAY,IAAI,EAAE,YAAY,KAAK,EACnD,IAAI,CAAC,CAAC;gBACJ,IAAI,WAAW,OAAO,IAAI,WAAW,OAAO,EAAE;oBAC5C,SAAS,CAAA,OAAQ,CAAC;4BAAE,GAAG,IAAI;4BAAE,SAAS,WAAW,OAAO;4BAAG,eAAe;wBAAM,CAAC;gBACnF,OAAO;oBACL,SAAS,CAAA,OAAQ,CAAC;4BAAE,GAAG,IAAI;4BAAE,eAAe;wBAAM,CAAC;gBACrD;YACH,GACC,KAAK,CAAC,CAAA;gBACJ,SAAS,CAAA,OAAQ,CAAC;wBAAE,GAAG,IAAI;wBAAE,eAAe;oBAAM,CAAC;YACtD;QAEJ,EAAE,OAAO,KAAU;YACjB,QAAQ,KAAK,CAAC;YACd,yBAAyB;YACzB,SAAS,CAAA,OAAQ,CAAC;oBAChB,GAAG,IAAI;oBACP,QAAQ;oBACR,OAAO,IAAI,OAAO,IAAI;oBACtB,eAAe;gBACjB,CAAC;QACH;IACF;IAEA,MAAM,cAAc;QAClB,yBAAyB;QACzB,IAAI,SAAS,OAAO,EAAE;YAClB,SAAS,OAAO,CAAC,WAAW,GAAG;YAC/B,SAAS,OAAO,CAAC,IAAI,GAAG,KAAK,CAAC,KAAO;QACzC;QACA,SAAS;YACP,QAAQ;YACR,MAAM;YACN,OAAO;YACP,SAAS;YACT,eAAe;YACf,OAAO;QACT;IACF;IAEA,uBAAuB;IACvB,MAAM,UAAU,kBACd,+YAAC;YAAI,KAAI;YAAoB,KAAI;YAAe,WAAU;;;;;;IAG5D,MAAM,gBAAgB,kBACpB,+YAAC;YAAI,KAAI;YAAmB,KAAI;YAAsB,WAAU;;;;;;IAGlE,MAAM,iBAAiB;QACrB,0VAAG,CAAC,OAAO,CAAC,OAAO,CAAC;IACtB;IAEA,IAAI,YAAY;QACd,qBACE,+YAAC;YAAI,WAAU;sBACb,cAAA,+YAAC;gBAAI,WAAU;0BACb,cAAA,+YAAC;;;;;;;;;;;;;;;IAIT;IAEA,qBACE,+YAAC;QAAI,WAAU;;0BACb,+YAAC;gBAAO,WAAU;0BAChB,cAAA,+YAAC;oBAAI,WAAU;;sCACb,+YAAC;4BAAI,WAAU;;8CACb,+YAAC;oCAAI,WAAU;8CACb,cAAA,+YAAC;;;;;;;;;;8CAEH,+YAAC;oCAAG,WAAU;8CAA+E;;;;;;;;;;;;sCAK/F,+YAAC;4BAAI,WAAU;;8CACb,+YAAC;oCAAK,WAAU;8CAA8D;;;;;;8CAC9E,+YAAC;oCACC,SAAS;oCACT,WAAU;;sDAER,+YAAC;4CAAI,OAAM;4CAA6B,OAAM;4CAAK,QAAO;4CAAK,SAAQ;4CAAY,MAAK;4CAAO,QAAO;4CAAe,aAAY;4CAAI,eAAc;4CAAQ,gBAAe;4CAAQ,WAAU;;8DAC1L,+YAAC;oDAAK,GAAE;;;;;;8DACR,+YAAC;oDAAO,IAAG;oDAAI,IAAG;oDAAI,GAAE;;;;;;8DACxB,+YAAC;oDAAK,GAAE;;;;;;8DACR,+YAAC;oDAAK,GAAE;;;;;;;;;;;;wCACJ;;;;;;;;;;;;;;;;;;;;;;;;0BAOhB,+YAAC;gBAAK,WAAU;;oBAEb,MAAM,MAAM,KAAK,wBAChB,+YAAC,8IAAU;wBACT,UAAU;wBACV,WAAW;wBACX,iBAAiB,SAAS,MAAM;;;;;;oBAInC,CAAC,MAAM,MAAM,KAAK,mBAAmB,MAAM,MAAM,KAAK,eAAe,MAAM,MAAM,KAAK,iBAAiB,KACrG,+CAA+C;kCAC/C,+YAAC;wBAAI,WAAU;kCACb,cAAA,+YAAC;4BAAI,WAAU;sCACb,cAAA,+YAAC;gCAAI,WAAU;;kDAEb,+YAAC;wCAAI,WAAU;kDACZ,cAAA,+YAAC;;;;;;;;;;kDAGJ,+YAAC;wCAAI,WAAU;;0DACb,+YAAC;gDAAG,WAAU;;oDACX,MAAM,MAAM,KAAK,mBAAmB;oDACpC,CAAC,MAAM,MAAM,KAAK,eAAe,MAAM,MAAM,KAAK,iBAAiB,KAAK;;;;;;;0DAE3E,+YAAC;gDAAE,WAAU;0DACV;;;;;;;;;;;;;;;;;;;;;;;;;;;;oBAQb,MAAM,MAAM,KAAK,cAAc,MAAM,IAAI,IAAI,MAAM,KAAK,kBACvD,+YAAC,4IAAS;wBACR,MAAM,MAAM,IAAI;wBAChB,OAAO,MAAM,KAAK;wBAClB,SAAS,MAAM,OAAO;wBACtB,eAAe,MAAM,aAAa;wBAClC,gBAAgB,SAAS,MAAM;wBAC/B,SAAS;wBACT,mCAAmC;wBACnC,aAAa;;;;;;oBAIhB,MAAM,MAAM,KAAK,yBAChB,+YAAC;wBAAI,WAAU;;0CACZ,+YAAC;gCAAI,WAAU;0CAA0C;;;;;;0CACzD,+YAAC;gCAAG,WAAU;0CAAoC;;;;;;0CAClD,+YAAC;gCAAE,WAAU;0CAAsB,MAAM,KAAK;;;;;;0CAC9C,+YAAC,sIAAM;gCAAC,SAAS;gCAAa,SAAQ;gCAAY,WAAU;0CAAiD;;;;;;;;;;;;kCAMlH,+YAAC;wBAAO,WAAU;kCAChB,cAAA,+YAAC;sCAAE;;;;;;;;;;;;;;;;;;;;;;;AAKb"}}]
}