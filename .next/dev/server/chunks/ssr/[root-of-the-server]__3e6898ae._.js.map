{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 148, "column": 0}, "map": {"version":3,"sources":["file:///home/tee/projects/personal/farcaster/roasted/src/app/actions.tsx"],"sourcesContent":["'use server';\n\nimport { GoogleGenAI } from \"@google/genai\";\nimport { put } from \"@vercel/blob\";\nimport Replicate from \"replicate\";\n\n// --- Types ---\nexport interface FarcasterUser {\n  fid: number;\n  username: string;\n  display_name: string;\n  pfp_url: string;\n  profile: { bio: { text: string } };\n  follower_count: number;\n  following_count: number;\n}\n\nexport interface Cast {\n  hash: string;\n  text: string;\n  parent_hash: string | null;\n  timestamp: string;\n  reactions: { likes_count: number; recasts_count: number };\n}\n\n// --- Configuration ---\n// Note: In Server Actions, process.env vars (without NEXT_PUBLIC) are secure.\nconst GEMINI_API_KEY = process.env.GEMINI_API_KEY || \"\";\nconst NEYNAR_API_KEY = process.env.NEYNAR_API_KEY || \"\";\nconst NEYNAR_API_URL = process.env.NEYNAR_API_URL || \"https://api.neynar.com/v2/farcaster\";\n\n\n\n\n// --- ACTION 2: Generate Meme (Using Replicate) ---\nexport async function generateMemeAction(user: FarcasterUser, roast: string): Promise<{\n  success: boolean;\n  memeUrl?: string;\n  error?: string;\n}> {\n  try {\n    if (!process.env.REPLICATE_API_TOKEN) {\n      throw new Error(\"Missing REPLICATE_API_TOKEN\");\n    }\n\n    const replicate = new Replicate({\n      auth: process.env.REPLICATE_API_TOKEN,\n    });\n\n    console.log(\"Distorting PFP using Instruct-Pix2Pix:\", user.username);\n\n    // Prompt: Instructions for how to change the face\n    const prompt = `\n      Turn this person into a crying clown. \n      Apply a deep fried meme filter. \n      Make the face look devastated, melting, and roasted.\n      Context: ${roast.slice(0, 30)}\n    `;\n\n    // MODEL: Instruct-Pix2Pix\n    // This is the ONLY fast model that reliably edits faces instead of replacing them.\n    const output = await replicate.run(\n      \"timothybrooks/instruct-pix2pix:30c1d0b916a6f8efce20493f5d61ee27491ab2a60437c13c588468b9810ec23f\",\n      {\n        input: {\n          image: user.pfp_url,    // ✅ The PFP goes here\n          prompt: prompt,         // ✅ The command goes here\n          image_guidance_scale: 1.5, // 1.5 = Keep face shape, but change texture\n          num_inference_steps: 20,\n        }\n      }\n    );\n\n    const memeUrl = Array.isArray(output) ? String(output[0]) : String(output);\n\n    return { success: true, memeUrl };\n\n  } catch (error: any) {\n    console.error(\"Replicate Error:\", error);\n    return { success: true, memeUrl: user.pfp_url }; // Fallback to original PFP\n  }\n}\n\n// --- ACTION 3: Upload Image to Vercel Blob ---\nexport async function uploadImageAction(formData: FormData): Promise<string> {\n  const file = formData.get('file') as File;\n  const filename = formData.get('filename') as string;\n\n  if (!file) {\n    throw new Error('No file provided');\n  }\n\n  // Upload to Vercel Blob\n  const blob = await put(filename, file, {\n    access: 'public',\n  });\n\n  return blob.url; // Returns the https://... public URL\n}"],"names":[],"mappings":";;;;;;;AAGA;AACA;;;;;AAqBA,wBAAwB;AACxB,8EAA8E;AAC9E,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc,IAAI;AACrD,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc,IAAI;AACrD,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc,IAAI;AAM9C,eAAe,mBAAmB,IAAmB,EAAE,KAAa;IAKzE,IAAI;QACF,IAAI,CAAC,QAAQ,GAAG,CAAC,mBAAmB,EAAE;YACpC,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,YAAY,IAAI,mMAAS,CAAC;YAC9B,MAAM,QAAQ,GAAG,CAAC,mBAAmB;QACvC;QAEA,QAAQ,GAAG,CAAC,0CAA0C,KAAK,QAAQ;QAEnE,kDAAkD;QAClD,MAAM,SAAS,CAAC;;;;eAIL,EAAE,MAAM,KAAK,CAAC,GAAG,IAAI;IAChC,CAAC;QAED,0BAA0B;QAC1B,mFAAmF;QACnF,MAAM,SAAS,MAAM,UAAU,GAAG,CAChC,mGACA;YACE,OAAO;gBACL,OAAO,KAAK,OAAO;gBACnB,QAAQ;gBACR,sBAAsB;gBACtB,qBAAqB;YACvB;QACF;QAGF,MAAM,UAAU,MAAM,OAAO,CAAC,UAAU,OAAO,MAAM,CAAC,EAAE,IAAI,OAAO;QAEnE,OAAO;YAAE,SAAS;YAAM;QAAQ;IAElC,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO;YAAE,SAAS;YAAM,SAAS,KAAK,OAAO;QAAC,GAAG,2BAA2B;IAC9E;AACF;AAGO,eAAe,kBAAkB,QAAkB;IACxD,MAAM,OAAO,SAAS,GAAG,CAAC;IAC1B,MAAM,WAAW,SAAS,GAAG,CAAC;IAE9B,IAAI,CAAC,MAAM;QACT,MAAM,IAAI,MAAM;IAClB;IAEA,wBAAwB;IACxB,MAAM,OAAO,MAAM,IAAA,qOAAG,EAAC,UAAU,MAAM;QACrC,QAAQ;IACV;IAEA,OAAO,KAAK,GAAG,EAAE,qCAAqC;AACxD;;;IA/DsB;IAiDA;;AAjDA,gZAAA;AAiDA,gZAAA"}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":["file:///home/tee/projects/personal/farcaster/roasted/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {generateMemeAction as '60d9fe79e76b1a05989be5e34f60e48cfebb8cb151'} from 'ACTIONS_MODULE0'\nexport {uploadImageAction as '40a2e178efb798952f0a9f0e3ba82fa274e9a4a5bc'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}