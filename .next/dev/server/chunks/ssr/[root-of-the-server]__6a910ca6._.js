module.exports = [
"[externals]/child_process [external] (child_process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/process [external] (process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("process", () => require("process"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/querystring [external] (querystring, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/fs/promises [external] (fs/promises, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs/promises", () => require("fs/promises"));

module.exports = mod;
}),
"[externals]/node:stream [external] (node:stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream", () => require("node:stream"));

module.exports = mod;
}),
"[externals]/node:stream/promises [external] (node:stream/promises, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream/promises", () => require("node:stream/promises"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[project]/src/app/actions.tsx [app-rsc] (ecmascript)", ((__turbopack_context__) => {
"use strict";

/* __next_internal_action_entry_do_not_use__ [{"406e3405653d65e174f660fc48b6a1922983761d12":"roastUserAction","60d9fe79e76b1a05989be5e34f60e48cfebb8cb151":"generateMemeAction"},"",""] */ __turbopack_context__.s([
    "generateMemeAction",
    ()=>generateMemeAction,
    "roastUserAction",
    ()=>roastUserAction
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$3_$40$babel$2b$core$40$7$2e$28$2e$5_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.0.3_@babel+core@7.28.5_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$google$2b$genai$40$1$2e$30$2e$0_bufferutil$40$4$2e$0$2e$9_utf$2d$8$2d$validate$40$5$2e$0$2e$10$2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/@google+genai@1.30.0_bufferutil@4.0.9_utf-8-validate@5.0.10/node_modules/@google/genai/dist/node/index.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$replicate$40$1$2e$4$2e$0$2f$node_modules$2f$replicate$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/replicate@1.4.0/node_modules/replicate/index.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$3_$40$babel$2b$core$40$7$2e$28$2e$5_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next@16.0.3_@babel+core@7.28.5_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js [app-rsc] (ecmascript)");
;
;
;
// --- Configuration ---
// Note: In Server Actions, process.env vars (without NEXT_PUBLIC) are secure.
const GEMINI_API_KEY = process.env.GEMINI_API_KEY || "";
const NEYNAR_API_KEY = process.env.NEYNAR_API_KEY || "";
const NEYNAR_API_URL = process.env.NEYNAR_API_URL || "https://api.neynar.com/v2/farcaster";
async function roastUserAction(username) {
    try {
        if (!GEMINI_API_KEY) throw new Error("Missing GEMINI_API_KEY in .env.local");
        if (!NEYNAR_API_KEY) throw new Error("Missing NEYNAR_API_KEY in .env.local");
        // Initialize SDK inside action
        const ai = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$google$2b$genai$40$1$2e$30$2e$0_bufferutil$40$4$2e$0$2e$9_utf$2d$8$2d$validate$40$5$2e$0$2e$10$2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["GoogleGenAI"]({
            apiKey: GEMINI_API_KEY
        });
        const cleanUsername = username.replace(/^@/, '').trim().toLowerCase();
        // 1. Fetch User
        const userRes = await fetch(`${NEYNAR_API_URL}/user/by_username?username=${cleanUsername}&viewer_fid=3`, {
            headers: {
                'accept': 'application/json',
                'api_key': NEYNAR_API_KEY
            },
            cache: 'no-store'
        });
        if (!userRes.ok) {
            if (userRes.status === 404) throw new Error(`User @${cleanUsername} not found.`);
            if (userRes.status === 429) throw new Error("Neynar Rate limit hit. Wait a minute.");
            throw new Error("Failed to fetch user profile.");
        }
        const userData = await userRes.json();
        const user = userData.user;
        // 2. Fetch Casts (Increased limit to 30, INCLUDE replies for audit)
        const castsRes = await fetch(`${NEYNAR_API_URL}/feed/user/casts?fid=${user.fid}&limit=30&include_replies=true&include_recasts=false`, {
            headers: {
                'accept': 'application/json',
                'api_key': NEYNAR_API_KEY
            },
            cache: 'no-store'
        });
        let castTexts = "";
        let replyTexts = "";
        if (castsRes.ok) {
            const castsData = await castsRes.json();
            const allCasts = castsData.casts || [];
            // Separate primary casts from replies
            const primaryCasts = allCasts.filter((c)=>!c.parent_hash);
            const replies = allCasts.filter((c)=>c.parent_hash);
            castTexts = primaryCasts.slice(0, 15).map((c)=>`- ${c.text} (Likes: ${c.reactions.likes_count})`).join('\n');
            replyTexts = replies.slice(0, 15).map((c)=>`- ${c.text}`).join('\n');
        }
        // 3. Generate Roast - CRINGE AUDIT PROMPT
        const ratio = user.follower_count > 0 ? (user.following_count / user.follower_count * 100).toFixed(0) : "0";
        const prompt = `
      ROAST TARGET: Farcaster User @${user.username} (${user.display_name})
      Bio: "${user.profile.bio.text}"
      Followers: ${user.follower_count} | Following: ${user.following_count} (${ratio}% ratio ðŸ’€)

      RECENT 90-DAY ACTIVITY (casts + ALL replies - dig for self-owns):
      ${castTexts}
      ${replyTexts ? `\nTHEIR REPLIES (Expose these):\n${replyTexts}` : '\nNO REPLIES (ghost account vibes)'}

      CRINGE AUDIT - EXPOSE THESE FIRST:
      1. **Bio Cringe**: Tryhard keywords, emoji spam, humblebrags, "DM for collabs"
      2. **Follower Ratio**: <10% = desperate followback farmer. >200% = spammer
      3. **Content Patterns**: 
         - "gm/fren/wagmi" count >3 = braindead crypto zombie
         - Replybegging ("LFG @vitalik ðŸ‘€", ratio replies > casts)
         - Self-quotes, "just minted" spam, "who's building?" virtue signals
         - Copy-paste thought-leader diarrhea
      4. **Engagement Whoring**: Likes-begging, "drop below", dead threads

      TASK: Deliver STAND-UP COMEDIAN HECKLER ROAST (60 words max)
      - Savage. Personal. Hit their deepest insecurity.
      - Structure: Opening punch â†’ Cringe expose â†’ Brutal closer
      - Voice: Don Rickles meets @basedjester
      - NO hashtags, disclaimers, mercy.
    `;
        const roastRes = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
            config: {
                systemInstruction: "You are a savage, ruthless roast master. You speak in a flowing, witty, and devastating manner. You do not list points, you weave them into a single brutal paragraph.",
                temperature: 1.1
            }
        });
        const roast = roastRes.text || "You're too boring to roast.";
        return {
            success: true,
            user,
            roast
        };
    } catch (error) {
        console.error('Roast Action Error:', error);
        return {
            success: false,
            error: error.message || 'Server error'
        };
    }
}
async function generateMemeAction(user, roast) {
    try {
        if (!process.env.REPLICATE_API_TOKEN) {
            throw new Error("Missing REPLICATE_API_TOKEN");
        }
        const replicate = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$replicate$40$1$2e$4$2e$0$2f$node_modules$2f$replicate$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["default"]({
            auth: process.env.REPLICATE_API_TOKEN
        });
        console.log("Distorting PFP using Instruct-Pix2Pix:", user.username);
        // Prompt: Instructions for how to change the face
        const prompt = `
      Turn this person into a crying clown. 
      Apply a deep fried meme filter. 
      Make the face look devastated, melting, and roasted.
      Context: ${roast.slice(0, 30)}
    `;
        // MODEL: Instruct-Pix2Pix
        // This is the ONLY fast model that reliably edits faces instead of replacing them.
        const output = await replicate.run("timothybrooks/instruct-pix2pix:30c1d0b916a6f8efce20493f5d61ee27491ab2a60437c13c588468b9810ec23f", {
            input: {
                image: user.pfp_url,
                prompt: prompt,
                image_guidance_scale: 1.5,
                num_inference_steps: 20
            }
        });
        const memeUrl = Array.isArray(output) ? String(output[0]) : String(output);
        return {
            success: true,
            memeUrl
        };
    } catch (error) {
        console.error("Replicate Error:", error);
        return {
            success: true,
            memeUrl: user.pfp_url
        }; // Fallback to original PFP
    }
}
;
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$3_$40$babel$2b$core$40$7$2e$28$2e$5_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ensureServerEntryExports"])([
    roastUserAction,
    generateMemeAction
]);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$3_$40$babel$2b$core$40$7$2e$28$2e$5_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(roastUserAction, "406e3405653d65e174f660fc48b6a1922983761d12", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$40$16$2e$0$2e$3_$40$babel$2b$core$40$7$2e$28$2e$5_react$2d$dom$40$19$2e$2$2e$0_react$40$19$2e$2$2e$0_$5f$react$40$19$2e$2$2e$0$2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(generateMemeAction, "60d9fe79e76b1a05989be5e34f60e48cfebb8cb151", null);
}),
"[project]/.next-internal/server/app/page/actions.js { ACTIONS_MODULE0 => \"[project]/src/app/actions.tsx [app-rsc] (ecmascript)\" } [app-rsc] (server actions loader, ecmascript) <locals>", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([]);
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$actions$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/app/actions.tsx [app-rsc] (ecmascript)");
;
;
}),
"[project]/.next-internal/server/app/page/actions.js { ACTIONS_MODULE0 => \"[project]/src/app/actions.tsx [app-rsc] (ecmascript)\" } [app-rsc] (server actions loader, ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "406e3405653d65e174f660fc48b6a1922983761d12",
    ()=>__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$actions$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["roastUserAction"],
    "60d9fe79e76b1a05989be5e34f60e48cfebb8cb151",
    ()=>__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$actions$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["generateMemeAction"]
]);
var __TURBOPACK__imported__module__$5b$project$5d2f2e$next$2d$internal$2f$server$2f$app$2f$page$2f$actions$2e$js__$7b$__ACTIONS_MODULE0__$3d3e$__$225b$project$5d2f$src$2f$app$2f$actions$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$2922$__$7d$__$5b$app$2d$rsc$5d$__$28$server__actions__loader$2c$__ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i('[project]/.next-internal/server/app/page/actions.js { ACTIONS_MODULE0 => "[project]/src/app/actions.tsx [app-rsc] (ecmascript)" } [app-rsc] (server actions loader, ecmascript) <locals>');
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$actions$2e$tsx__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/app/actions.tsx [app-rsc] (ecmascript)");
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__6a910ca6._.js.map